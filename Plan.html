<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Nature Wellness - Accumulative Business Calculator</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5986 100%);
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        }

        /* Header */
        .header {
            background: linear-gradient(90deg, #f9a825 0%, #fdd835 100%);
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 65px;
            height: 65px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2e7d32;
            font-size: 9px;
            text-align: center;
            line-height: 1.1;
            padding: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .header-text h1 {
            color: white;
            font-size: 26px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 5px;
        }

        .header-text .subtitle {
            color: #1e3a5f;
            font-weight: bold;
            font-size: 13px;
        }

        .header-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            background: white;
            color: #1e3a5f;
            transition: all 0.3s;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Content */
        .content {
            padding: 25px;
        }

        /* Info Banner */
        .info-banner {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid #2196f3;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .info-banner h3 {
            color: #1565c0;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .info-banner ul {
            margin-left: 20px;
            color: #0d47a1;
        }

        .info-banner li {
            margin: 5px 0;
            font-size: 14px;
        }

        /* Settings Section */
        .settings-section {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 3px solid #f9a825;
        }

        .settings-title {
            color: #e65100;
            margin-bottom: 15px;
            font-size: 17px;
            font-weight: bold;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .input-group label {
            display: block;
            color: #bf360c;
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #f9a825;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            color: #1e3a5f;
        }

        /* Distribution Section Styles */
        .distribution-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #667eea;
            margin-bottom: 30px;
        }

        .distribution-category {
            margin-bottom: 25px;
        }

        .distribution-category-title {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 2px solid;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .distribution-item {
            display: grid;
            grid-template-columns: 200px 1fr 60px;
            gap: 15px;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }

        .distribution-item:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }

        .dist-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 13px;
        }

        .dist-bar-container {
            background: #ecf0f1;
            border-radius: 10px;
            height: 25px;
            overflow: hidden;
            position: relative;
        }

        .dist-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 11px;
            font-weight: bold;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .dist-percentage {
            font-weight: bold;
            color: #2c3e50;
            font-size: 16px;
            text-align: center;
        }

        .distribution-total {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            text-align: center;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .distribution-total-text {
            color: white;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .distribution-total-subtext {
            color: rgba(255,255,255,0.9);
            font-size: 12px;
        }

        /* Compact Distribution Items */
        .distribution-item-compact {
            display: grid;
            grid-template-columns: 140px 1fr 50px;
            gap: 10px;
            align-items: center;
            padding: 6px 8px;
            background: white;
            border-radius: 6px;
            margin-bottom: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }

        .distribution-item-compact:hover {
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transform: translateX(3px);
        }

        .dist-label-compact {
            font-weight: 600;
            color: #2c3e50;
            font-size: 11px;
        }

        .dist-bar-container-compact {
            background: #ecf0f1;
            border-radius: 8px;
            height: 18px;
            overflow: hidden;
            position: relative;
        }

        .dist-bar-compact {
            height: 100%;
            border-radius: 8px;
            transition: width 0.4s ease;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.15);
        }

        .dist-percentage-compact {
            font-weight: bold;
            color: #2c3e50;
            font-size: 13px;
            text-align: center;
        }

        /* Modern Distribution Category Boxes */
        .dist-category-box {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            position: relative;
            height: 180px;
            display: flex;
            flex-direction: column;
        }
        
        .dist-category-box > div:last-child {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .dist-category-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .dist-category-header {
            color: white;
            padding: 8px 10px;
            font-weight: bold;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 8px;
        }
        
        /* Dynamic font sizes based on percentage */
        .dist-category-header[data-percent="23"],
        .dist-category-header[data-percent="21"] {
            font-size: 11.5px;
        }
        
        .dist-category-header[data-percent="12"] {
            font-size: 10px;
        }
        
        .dist-category-header[data-percent="7"] {
            font-size: 9px;
        }
        
        .dist-category-header[data-percent="5"] {
            font-size: 8.5px;
        }
        
        .dist-category-header[data-percent="4"] {
            font-size: 8px;
        }

        .dist-category-total {
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: bold;
        }

        .dist-mini-items {
            padding: 8px;
        }

        .dist-mini-item {
            display: grid;
            grid-template-columns: 60px 1fr 30px;
            gap: 6px;
            align-items: center;
            margin-bottom: 5px;
        }

        .dist-mini-item:last-child {
            margin-bottom: 0;
        }

        .dist-mini-label {
            font-size: 9px;
            font-weight: 600;
            color: #2c3e50;
        }

        .dist-mini-bar-container {
            background: #ecf0f1;
            border-radius: 6px;
            height: 14px;
            overflow: hidden;
        }

        .dist-mini-bar {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);
        }

        .dist-mini-value {
            font-size: 10px;
            font-weight: bold;
            color: #2c3e50;
            text-align: right;
        }

        /* Modal Overlay for Full Screen Card View */
        .card-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .card-modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .card-modal-content {
            width: 95%;
            max-width: 1400px;
            max-height: 95vh;
            overflow-y: auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease;
            position: relative;
        }

        @keyframes slideIn {
            from { 
                transform: scale(0.8) translateY(-50px);
                opacity: 0;
            }
            to { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .card-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            font-size: 32px;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5);
            font-weight: bold;
            line-height: 1;
        }

        .card-modal-close:hover {
            background: #c0392b;
            transform: scale(1.15) rotate(90deg);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.8);
        }

        .card-modal-content .dist-category-box {
            border: none;
            box-shadow: none;
            max-height: none !important;
            height: auto !important;
            width: 100%;
            display: block !important;
        }
        
        .card-modal-content .dist-category-box > div:last-child {
            overflow-y: visible !important;
            flex: none !important;
        }

        .card-modal-content .dist-category-header {
            font-size: 32px;
            padding: 30px 80px 30px 35px;
        }

        .card-modal-content .dist-category-total {
            font-size: 36px;
            padding: 6px 16px;
        }

        .card-modal-content table {
            font-size: 18px !important;
        }

        .card-modal-content table th,
        .card-modal-content table td {
            padding: 14px !important;
            font-size: 17px !important;
        }

        .card-modal-content .dist-mini-items > div {
            max-height: none !important;
            overflow-y: visible !important;
        }

        .card-modal-content > div > div {
            max-height: none !important;
            overflow-y: visible !important;
            padding: 25px !important;
            font-size: 18px !important;
        }

        .card-modal-content .dist-mini-item {
            grid-template-columns: 200px 1fr 90px;
            gap: 18px;
            margin-bottom: 18px;
        }

        .card-modal-content .dist-mini-label {
            font-size: 20px;
        }

        .card-modal-content .dist-mini-bar-container {
            height: 32px;
        }

        .card-modal-content .dist-mini-value {
            font-size: 22px;
        }

        /* Enhanced styles for detailed cards in modal */
        .card-modal-content div[style*="font-size: 6"] {
            font-size: 16px !important;
        }

        .card-modal-content div[style*="font-size: 7"] {
            font-size: 18px !important;
        }

        .card-modal-content div[style*="font-size: 8"] {
            font-size: 20px !important;
        }

        .card-modal-content div[style*="font-size: 9"] {
            font-size: 22px !important;
        }

        .card-modal-content div[style*="font-size: 10"] {
            font-size: 24px !important;
        }

        .card-modal-content div[style*="padding: 2px"] {
            padding: 14px !important;
        }

        .card-modal-content div[style*="padding: 3px"] {
            padding: 16px !important;
        }

        .card-modal-content div[style*="padding: 4px"] {
            padding: 18px !important;
        }

        .card-modal-content div[style*="padding: 5px"] {
            padding: 20px !important;
        }

        .card-modal-content div[style*="padding: 6px"] {
            padding: 22px !important;
        }

        .card-modal-content div[style*="border-radius: 2px"],
        .card-modal-content div[style*="border-radius: 3px"],
        .card-modal-content div[style*="border-radius: 4px"] {
            border-radius: 10px !important;
        }

        .card-modal-content div[style*="margin-bottom: 2px"] {
            margin-bottom: 12px !important;
        }

        .card-modal-content div[style*="margin-bottom: 3px"] {
            margin-bottom: 14px !important;
        }

        .card-modal-content div[style*="margin-bottom: 4px"] {
            margin-bottom: 16px !important;
        }

        .card-modal-content div[style*="line-height: 1.3"],
        .card-modal-content div[style*="line-height: 1.4"] {
            line-height: 1.8 !important;
        }

        /* Specific enhancements for inline badges and labels */
        .card-modal-content span[style*="font-size: 6px"] {
            font-size: 14px !important;
        }

        .card-modal-content span[style*="font-size: 7px"] {
            font-size: 16px !important;
        }

        .card-modal-content span[style*="font-size: 8px"] {
            font-size: 18px !important;
        }

        .card-modal-content span[style*="font-size: 9px"] {
            font-size: 20px !important;
        }

        /* Responsive for Mobile */
        @media (max-width: 768px) {
            .card-modal-overlay {
                padding: 10px;
            }

            .card-modal-content {
                width: 98%;
                max-height: 92vh;
                padding-top: 10px;
            }

            .card-modal-close {
                top: 10px;
                right: 10px;
                width: 48px;
                height: 48px;
                font-size: 28px;
            }

            .card-modal-content .dist-category-header {
                font-size: 22px;
                padding: 20px 65px 20px 15px;
            }

            .card-modal-content .dist-category-total {
                font-size: 26px;
            }

            .card-modal-content table {
                font-size: 14px !important;
            }

            .card-modal-content table th,
            .card-modal-content table td {
                padding: 10px 6px !important;
                font-size: 13px !important;
            }

            .card-modal-content .dist-mini-item {
                grid-template-columns: 120px 1fr 60px;
                gap: 12px;
            }

            .card-modal-content .dist-mini-label {
                font-size: 16px;
            }

            .card-modal-content .dist-mini-bar-container {
                height: 24px;
            }

            .card-modal-content .dist-mini-value {
                font-size: 18px;
            }

            .card-modal-content > div > div {
                padding: 15px !important;
                font-size: 15px !important;
            }

            .card-modal-content div[style*="font-size: 6"],
            .card-modal-content div[style*="font-size: 7"] {
                font-size: 14px !important;
            }

            .card-modal-content div[style*="font-size: 8"] {
                font-size: 16px !important;
            }

            .card-modal-content div[style*="padding: 2px"],
            .card-modal-content div[style*="padding: 3px"],
            .card-modal-content div[style*="padding: 4px"],
            .card-modal-content div[style*="padding: 5px"],
            .card-modal-content div[style*="padding: 6px"] {
                padding: 10px !important;
            }

            .card-modal-content span[style*="font-size: 6px"],
            .card-modal-content span[style*="font-size: 7px"] {
                font-size: 12px !important;
            }

            .card-modal-content span[style*="font-size: 8px"],
            .card-modal-content span[style*="font-size: 9px"] {
                font-size: 14px !important;
            }
        }

        @media (max-width: 480px) {
            .card-modal-content {
                width: 100%;
                max-height: 95vh;
                border-radius: 10px;
            }

            .card-modal-close {
                top: 8px;
                right: 8px;
                width: 42px;
                height: 42px;
                font-size: 26px;
            }

            .card-modal-content .dist-category-header {
                font-size: 18px;
                padding: 15px 55px 15px 12px;
            }

            .card-modal-content .dist-category-total {
                font-size: 22px;
            }

            .card-modal-content table th,
            .card-modal-content table td {
                padding: 8px 4px !important;
                font-size: 11px !important;
            }

            .card-modal-content .dist-mini-item {
                grid-template-columns: 90px 1fr 50px;
                gap: 8px;
            }

            .card-modal-content .dist-mini-label {
                font-size: 13px;
            }

            .card-modal-content .dist-mini-bar-container {
                height: 20px;
            }

            .card-modal-content .dist-mini-value {
                font-size: 15px;
            }

            .card-modal-content > div > div {
                padding: 12px !important;
                font-size: 13px !important;
            }

            .card-modal-content div[style*="font-size: 6"],
            .card-modal-content div[style*="font-size: 7"],
            .card-modal-content div[style*="font-size: 8"] {
                font-size: 12px !important;
            }

            .card-modal-content div[style*="padding: 2px"],
            .card-modal-content div[style*="padding: 3px"],
            .card-modal-content div[style*="padding: 4px"],
            .card-modal-content div[style*="padding: 5px"],
            .card-modal-content div[style*="padding: 6px"] {
                padding: 8px !important;
            }

            .card-modal-content span[style*="font-size: 6px"],
            .card-modal-content span[style*="font-size: 7px"],
            .card-modal-content span[style*="font-size: 8px"],
            .card-modal-content span[style*="font-size: 9px"] {
                font-size: 11px !important;
            }
        }

        .card-modal-content .dist-mini-label {
            font-size: 16px;
        }

        .card-modal-content .dist-mini-bar-container {
            height: 24px;
        }

        .card-modal-content .dist-mini-value {
            font-size: 18px;
        }

        /* Hover effect on cards to indicate clickable */
        .dist-category-box {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dist-category-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .dist-category-box::after {
            content: "üîç Double-click to expand";
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 8px;
            color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .dist-category-box:hover::after {
            opacity: 1;
        }

        /* Grid-based Distribution Model */
        .distribution-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        @media (max-width: 1200px) {
            .distribution-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .distribution-grid {
                grid-template-columns: 1fr;
            }
        }

        .dist-box {
            padding: 15px;
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .dist-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
            border-color: rgba(255,255,255,0.6);
        }

        .dist-box::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 0.6; }
        }

        .dist-box-icon {
            font-size: 28px;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .dist-box-title {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
            letter-spacing: 0.5px;
        }

        .dist-box-percent {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            line-height: 1;
        }

        .dist-box-items {
            background: rgba(255,255,255,0.15);
            padding: 8px;
            border-radius: 6px;
            font-size: 11px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .dist-box-item {
            margin: 3px 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            line-height: 1.4;
        }

        /* Quick Fill */
        .quick-fill {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .quick-fill-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 13px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        .quick-fill-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }

        /* Section Title */
        .section-title {
            background: linear-gradient(90deg, #1e3a5f 0%, #2d5986 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5986 100%);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
            border: 1px solid #1e3a5f;
        }

        td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        td input {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.3s;
        }

        td input:focus {
            outline: none;
            border-color: #f9a825;
            box-shadow: 0 0 8px rgba(249, 168, 37, 0.3);
        }

        /* Remove spinner buttons from number inputs */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .month-cell {
            background: linear-gradient(135deg, #ffd54f 0%, #ffb74d 100%);
            font-weight: bold;
            color: #1e3a5f;
        }

        .result-cell {
            background: #e8f5e9;
            font-weight: bold;
            color: #1b5e20;
        }

        .rank-cell {
            font-weight: bold;
            padding: 10px;
        }

        /* Performance Bonus Section - HORIZONTAL LAYOUT like PDF Page 5 */
        .performance-section {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 3px solid #9c27b0;
        }

        .performance-title {
            color: #6a1b9a;
            margin-bottom: 25px;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
        }

        .performance-subtitle {
            text-align: center;
            color: #7b1fa2;
            font-size: 14px;
            margin-bottom: 25px;
            font-style: italic;
        }

        /* Horizontal Layout Container */
        .performance-horizontal {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Top Section - You (Center) with Associates (A1-A5) Below */
        .perf-main-person {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-align: center;
            border: 3px solid #9c27b0;
        }

        .perf-main-person h4 {
            color: #6a1b9a;
            font-size: 18px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .perf-main-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .perf-input-item {
            text-align: center;
        }

        .perf-input-item label {
            display: block;
            font-weight: bold;
            color: #4a148c;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .perf-input-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #9c27b0;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            font-size: 16px;
        }

        /* Associates Row - Horizontal Layout */
        .perf-associates-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        .perf-associate-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #ba68c8;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .perf-associate-card h5 {
            color: #7b1fa2;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid #e1bee7;
            padding-bottom: 10px;
        }

        .perf-associate-inputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .perf-assoc-input-row {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .perf-assoc-input-row label {
            font-weight: bold;
            color: #6a1b9a;
            font-size: 12px;
        }

        .perf-assoc-input-row input {
            padding: 10px;
            border: 2px solid #ba68c8;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            font-size: 14px;
        }

        .perf-assoc-input-row input:disabled {
            background: #f5f5f5;
            color: #666;
        }

        .perf-rate-display {
            margin-top: 10px;
            padding: 8px;
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            color: #6a1b9a;
            font-size: 13px;
            border: 1px solid #ba68c8;
        }

        /* Performance Result - Bottom */
        .performance-result {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .performance-result h3 {
            font-size: 20px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .performance-result .amount {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .performance-breakdown {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .breakdown-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
        }

        .breakdown-item .label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .breakdown-item .value {
            font-size: 18px;
            font-weight: bold;
        }

        /* Group BV Display */
        .group-bv-section {
            background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 3px solid #3f51b5;
        }

        .group-bv-title {
            color: #1a237e;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .group-bv-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        .group-bv-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .group-bv-card h4 {
            color: #3f51b5;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .group-bv-card .bv-amount {
            font-size: 20px;
            font-weight: bold;
            color: #1a237e;
        }

        /* Income Cards */
        .income-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .income-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 6px solid;
        }

        .income-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .income-card-1 { border-left-color: #ff6b6b; }
        .income-card-2 { border-left-color: #4ecdc4; }
        .income-card-3 { border-left-color: #45b7d1; }
        .income-card-4 { border-left-color: #f7b731; }
        .income-card-5 { border-left-color: #5f27cd; }
        .income-card-6 { border-left-color: #00d2d3; }
        .income-card-7 { border-left-color: #ff9ff3; }
        .income-card-8 { border-left-color: #54a0ff; }
        .income-card-9 { border-left-color: #48dbfb; }
        .income-card-10 { border-left-color: #1dd1a1; }
        .income-card-11 { border-left-color: #feca57; }

        .income-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .income-card .amount {
            font-size: 28px;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 10px;
        }

        .income-card .description {
            color: #7f8c8d;
            font-size: 13px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .income-card .details {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #495057;
            line-height: 1.6;
        }

        /* Summary Card */
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .summary-card h2 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-item .label {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-item .value {
            font-size: 26px;
            font-weight: bold;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .perf-associates-row {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .performance-breakdown {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .group-bv-grid {
                grid-template-columns: 1fr;
            }

            .perf-main-inputs {
                grid-template-columns: 1fr;
            }

            .perf-associates-row {
                grid-template-columns: 1fr;
            }

            .performance-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">
                    DR. NATURE<br>TRULY<br>NATURAL
                </div>
                <div class="header-text">
                    <h1>üåø DR. NATURE WELLNESS</h1>
                    <div class="subtitle">Accumulative Business Calculator - Enhanced Version</div>
                </div>
            </div>
            <div class="header-controls">
                <button class="btn" onclick="exportToExcel()">üìä Export to Excel</button>
                <button class="btn" onclick="clearAll()">üóëÔ∏è Clear All</button>
                <button class="btn" onclick="calculateAll()">üîÑ Recalculate</button>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Info Banner -->
            <div class="info-banner">
                <h3>‚ÑπÔ∏è ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä (Important Information)</h3>
                <ul>
                    <li><strong>DP to BV Conversion:</strong> Direct Purchase ka Business Volume calculate hota hai (percentage Calculator Settings ‡§Æ‡•á‡§Ç set kar sakte hain)</li>
                    <li><strong>G1 to G5 Groups:</strong> ‡§∏‡§≠‡•Ä legs ‡§ï‡•ã G1, G2, G3, G4, G5 ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç input ‡§ï‡§∞‡•á‡§Ç (BV values)</li>
                    <li><strong>Optional G5:</strong> Group 5 optional hai, agar value na ho to 0 ‡§∞‡§ñ‡•á‡§Ç</li>
                    <li><strong>Auto-Sync Feature:</strong> Group BV values automatically Performance Calculator ‡§Æ‡•á‡§Ç sync ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç</li>
                    <li><strong>Individual Group BV:</strong> ‡§π‡§∞ leg ‡§ï‡§æ cumulative Group BV ‡§Ö‡§≤‡§ó ‡§∏‡•á ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ</li>
                    <li><strong>Calculator Settings:</strong> ‡§∏‡§≠‡•Ä rates ‡§î‡§∞ percentages ‡§ï‡•ã ‚öôÔ∏è Calculator Settings section ‡§Æ‡•á‡§Ç customize ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç</li>
                </ul>
            </div>

            <!-- Settings -->
            <div class="settings-section">
                <h3 class="settings-title">‚öôÔ∏è Calculator Settings</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <!-- Card 1: Basic Settings -->
                    <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 10px; padding: 15px;">
                        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #495057; border-bottom: 2px solid #007bff; padding-bottom: 6px;">üìä Basic Parameters</h4>
                        <div style="display: grid; gap: 10px;">
                            <div class="input-group" style="margin: 0;">
                                <label style="font-size: 12px; margin-bottom: 4px;">Retail Margin (%)</label>
                                <input type="number" id="retailMargin" value="30" onchange="calculateAll()" min="0" max="100" step="0.1" style="padding: 6px; font-size: 13px;">
                            </div>
                            <div class="input-group" style="margin: 0;">
                                <label style="font-size: 12px; margin-bottom: 4px;">DP to BV Conversion Rate (%)</label>
                                <input type="number" id="dpToBvRate" value="35" onchange="calculateAll()" min="0" max="100" step="0.1" style="padding: 6px; font-size: 13px;">
                            </div>
                            <div class="input-group" style="margin: 0;">
                                <label style="font-size: 12px; margin-bottom: 4px;">CTO (Company Turn Over) ‚Çπ</label>
                                <input type="number" id="companyTurnOver" value="10000000" onchange="calculateAll()" style="padding: 6px; font-size: 13px;">
                            </div>
                            <div class="input-group" style="margin: 0;">
                                <label style="font-size: 12px; margin-bottom: 4px;">Total Qualifiers</label>
                                <input type="number" id="bonusPoint" value="1000" onchange="calculateAll()" min="0" step="1" style="padding: 6px; font-size: 13px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card 2: Bonus Qualifiers -->
                    <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 10px; padding: 15px;">
                        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #495057; border-bottom: 2px solid #28a745; padding-bottom: 6px;">üéÅ Bonus Qualifiers</h4>
                        <div style="display: grid; gap: 10px;">
                            <div style="background: #fff3cd; padding: 8px; border-radius: 6px; border-left: 3px solid #ffc107;">
                                <strong style="font-size: 12px; color: #856404;">Team Building Bonus</strong>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-top: 6px;">
                                    <div class="input-group" style="margin: 0;">
                                        <label style="font-size: 11px; margin-bottom: 2px;">2X</label>
                                        <input type="number" id="tbb2x" value="300" onchange="calculateAll()" style="padding: 4px; font-size: 12px;">
                                    </div>
                                    <div class="input-group" style="margin: 0;">
                                        <label style="font-size: 11px; margin-bottom: 2px;">3X</label>
                                        <input type="number" id="tbb3x" value="300" onchange="calculateAll()" style="padding: 4px; font-size: 12px;">
                                    </div>
                                    <div class="input-group" style="margin: 0;">
                                        <label style="font-size: 11px; margin-bottom: 2px;">4X</label>
                                        <input type="number" id="tbb4x" value="300" onchange="calculateAll()" style="padding: 4px; font-size: 12px;">
                                    </div>
                                </div>
                            </div>
                            <div style="background: #d1ecf1; padding: 8px; border-radius: 6px; border-left: 3px solid #17a2b8;">
                                <strong style="font-size: 12px; color: #0c5460;">Business Building Bonus</strong>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-top: 6px;">
                                    <div class="input-group" style="margin: 0;">
                                        <label style="font-size: 11px; margin-bottom: 2px;">2X</label>
                                        <input type="number" id="bbb2x" value="300" onchange="calculateAll()" style="padding: 4px; font-size: 12px;">
                                    </div>
                                    <div class="input-group" style="margin: 0;">
                                        <label style="font-size: 11px; margin-bottom: 2px;">3X</label>
                                        <input type="number" id="bbb3x" value="300" onchange="calculateAll()" style="padding: 4px; font-size: 12px;">
                                    </div>
                                    <div class="input-group" style="margin: 0;">
                                        <label style="font-size: 11px; margin-bottom: 2px;">4X</label>
                                        <input type="number" id="bbb4x" value="300" onchange="calculateAll()" style="padding: 4px; font-size: 12px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Hidden fields for fixed rates -->
                <input type="hidden" id="directorFundRate" value="4">
                <input type="hidden" id="royaltyRate" value="5">
            </div>

            <!-- BV Distribution Section -->
            <div class="calculator-settings">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div>
                        <h3 class="settings-title" style="margin-bottom: 4px;">üìä BV Distribution Model</h3>
                        <p style="color: #666; font-size: 10px; margin: 0;">100% BV allocation across 8 major categories</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); padding: 8px 16px; border-radius: 8px; text-align: center; border: 2px solid #fff; box-shadow: 0 3px 10px rgba(0,0,0,0.2);">
                        <div style="color: white; font-size: 14px; font-weight: bold;">
                            ‚úì TOTAL = 100%
                        </div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 8px; margin-top: 2px;">
                            (23+7+21+21+4+12+7+5)
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px;">
                    <!-- Box 1: Performance Only -->
                    <div class="dist-category-box" style="border: 3px solid #667eea; background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); font-size: 11.5px;">
                            ‚≠ê Performance Bonus
                            <span class="dist-category-total">23%</span>
                        </div>
                        <div style="padding: 6px;">
                            <table style="width: 100%; font-size: 8px; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: white;">
                                        <th style="padding: 4px; text-align: left; border: 1px solid #667eea; font-weight: 700;">WHEN YOUR TGBV REACHES AT</th>
                                        <th style="padding: 4px; text-align: center; border: 1px solid #667eea; font-weight: 700;">YOUR PERFORMANCE INCOME LEVEL</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="background: #fff;">
                                        <td style="padding: 5px 6px; border: 1px solid #ddd; font-weight: 600;">0 - 5,000 GBV</td>
                                        <td style="padding: 5px; border: 1px solid #ddd; text-align: center; font-weight: 700; font-size: 10px; color: #667eea;">5%</td>
                                    </tr>
                                    <tr style="background: #f8f9ff;">
                                        <td style="padding: 5px 6px; border: 1px solid #ddd; font-weight: 600;">5,001 - 20,000 GBV</td>
                                        <td style="padding: 5px; border: 1px solid #ddd; text-align: center; font-weight: 700; font-size: 10px; color: #667eea;">11%</td>
                                    </tr>
                                    <tr style="background: #fff;">
                                        <td style="padding: 5px 6px; border: 1px solid #ddd; font-weight: 600;">20,001 - 40,000 GBV</td>
                                        <td style="padding: 5px; border: 1px solid #ddd; text-align: center; font-weight: 700; font-size: 10px; color: #667eea;">15%</td>
                                    </tr>
                                    <tr style="background: #f8f9ff;">
                                        <td style="padding: 5px 6px; border: 1px solid #ddd; font-weight: 600;">40,001 - 80,000 GBV</td>
                                        <td style="padding: 5px; border: 1px solid #ddd; text-align: center; font-weight: 700; font-size: 10px; color: #667eea;">19%</td>
                                    </tr>
                                    <tr style="background: #fff;">
                                        <td style="padding: 5px 6px; border: 1px solid #ddd; font-weight: 600;">80,001 & ABOVE GBV</td>
                                        <td style="padding: 5px; border: 1px solid #ddd; text-align: center; font-weight: 700; font-size: 10px; color: #667eea;">23%</td>
                                    </tr>
                                    <tr style="background: linear-gradient(90deg, #00bcd4 0%, #0097a7 100%); color: white;">
                                        <td style="padding: 5px 6px; border: 1px solid #00bcd4; font-weight: 700; font-size: 7px;">FAST TRACK (40,000 GBV)<br>IN A CLOSING MONTH</td>
                                        <td style="padding: 5px; border: 1px solid #00bcd4; text-align: center; font-weight: 700; font-size: 11px;">23%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div style="font-size: 7px; color: #666; margin-top: 3px; text-align: center;">
                                TGBV = Total Group Business Volume
                            </div>
                        </div>
                    </div>

                    <!-- Box 2: Team Building (NEW) -->
                    <div class="dist-category-box" style="border: 3px solid #f093fb; background: linear-gradient(135deg, #ffffff 0%, #fff8fa 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%); font-size: 9px;">
                            ü§ù Team Building Bonus
                            <span class="dist-category-total">7%</span>
                        </div>
                        <div style="padding: 6px; font-size: 7px;">
                            <div style="background: #2c3e50; color: #ffd700; text-align: center; padding: 2px; border-radius: 3px; margin-bottom: 4px; font-weight: bold;">
                                (EXCLUSIVE FOR DIRECTORS & BELOW)
                            </div>
                            
                            <!-- 2X Bonus -->
                            <div style="background: #c8b068; padding: 4px; border-radius: 4px; margin-bottom: 3px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 700; color: #2c3e50;">2X BONUS</div>
                                    <div style="background: #c8b068; color: #2c3e50; padding: 2px 6px; border-radius: 3px; font-weight: 700; font-size: 9px;">3%</div>
                                </div>
                                <div style="font-size: 6px; color: #2c3e50; margin-top: 2px; line-height: 1.3;">
                                    Minimum 2500 GBV from 2 different legs
                                </div>
                            </div>

                            <!-- 3X Bonus -->
                            <div style="background: #c2185b; padding: 4px; border-radius: 4px; margin-bottom: 3px; color: white;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 700;">3X BONUS</div>
                                    <div style="background: rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 3px; font-weight: 700; font-size: 9px;">2%</div>
                                </div>
                                <div style="font-size: 6px; margin-top: 2px; line-height: 1.3;">
                                    Minimum 2500 GBV from 3 different legs
                                </div>
                            </div>

                            <!-- 4X Bonus -->
                            <div style="background: #388e3c; padding: 4px; border-radius: 4px; margin-bottom: 3px; color: white;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 700;">4X BONUS</div>
                                    <div style="background: rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 3px; font-weight: 700; font-size: 9px;">2%</div>
                                </div>
                                <div style="font-size: 6px; margin-top: 2px; line-height: 1.3;">
                                    Minimum 2500 GBV from 4 different legs
                                </div>
                            </div>

                            <!-- Important Note -->
                            <div style="background: #c8b068; padding: 3px; border-radius: 3px; margin-bottom: 3px; text-align: center; font-weight: 600; color: #2c3e50;">
                                Max 25,000 GBV/Leg counted
                            </div>

                            <!-- Cumulative Fund -->
                            <div style="font-size: 6px; color: #666; line-height: 1.3; text-align: center; margin-top: 2px;">
                                <div>2X: 3% | 2X+3X: 5% | 2X+3X+4X: 7%</div>
                                <div style="margin-top: 1px;">Formula: Your GBV / Sum of all qualifiers √ó % of CTO</div>
                            </div>
                        </div>
                    </div>

                    <!-- Box 3: Business Building (KEPT) -->
                    <div class="dist-category-box" style="border: 3px solid #f5576c; background: linear-gradient(135deg, #ffffff 0%, #fff8f9 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #f5576c 0%, #fee140 100%);">
                            üöÄ Business Building Bonus
                            <span class="dist-category-total">21%</span>
                        </div>
                        <div style="padding: 5px; font-size: 6.5px; max-height: 180px; overflow-y: auto;">
                            
                            <!-- 2X Bonus -->
                            <div style="border: 2px solid #c8b068; border-radius: 4px; margin-bottom: 3px; overflow: hidden;">
                                <div style="background: #c8b068; padding: 3px; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 700; color: #2c3e50; font-size: 8px;">2X BONUS</div>
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px 5px; border-radius: 3px; font-weight: 700; font-size: 8px;">8%</div>
                                </div>
                                <div style="background: white; padding: 3px;">
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px; text-align: center; font-weight: 600; margin-bottom: 2px; border-radius: 2px;">
                                        BRONZE DIRECTORS & ABOVE
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                                        <div style="color: #666;">
                                            <div>‚úì Self: 500 BV</div>
                                            <div>‚úì Min 2 legs √ó 10K GBV</div>
                                        </div>
                                        <div style="background: #ff4757; color: white; padding: 2px 4px; border-radius: 2px; font-weight: 700; align-self: flex-start;">
                                            Max: ‚Çπ20,000
                                        </div>
                                    </div>
                                    <div style="font-size: 5.5px; color: #888; line-height: 1.2;">
                                        Eligible: Performance 23% ‚Ä¢ Director 4% ‚Ä¢ Travel 2% ‚Ä¢ Leadership 13%
                                    </div>
                                </div>
                            </div>

                            <!-- 3X Bonus -->
                            <div style="border: 2px solid #e8b44a; border-radius: 4px; margin-bottom: 3px; overflow: hidden;">
                                <div style="background: #e8b44a; padding: 3px; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 700; color: #2c3e50; font-size: 8px;">3X BONUS</div>
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px 5px; border-radius: 3px; font-weight: 700; font-size: 8px;">8%</div>
                                </div>
                                <div style="background: white; padding: 3px;">
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px; text-align: center; font-weight: 600; margin-bottom: 2px; border-radius: 2px;">
                                        SILVER DIRECTORS & ABOVE
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                                        <div style="color: #666;">
                                            <div>‚úì Self: 500 BV</div>
                                            <div>‚úì Min 3 legs √ó 10K GBV</div>
                                        </div>
                                        <div style="background: #ff4757; color: white; padding: 2px 4px; border-radius: 2px; font-weight: 700; align-self: flex-start;">
                                            Max: ‚Çπ1,00,000
                                        </div>
                                    </div>
                                    <div style="font-size: 5.5px; color: #888; line-height: 1.2;">
                                        Eligible: Performance 23% ‚Ä¢ Director 4% ‚Ä¢ Travel 2% ‚Ä¢ 2 Wheeler 2% ‚Ä¢ Leadership 15% ‚Ä¢ BB 2X 8%
                                    </div>
                                </div>
                            </div>

                            <!-- 4X Bonus -->
                            <div style="border: 2px solid #ffa502; border-radius: 4px; margin-bottom: 2px; overflow: hidden;">
                                <div style="background: #ffa502; padding: 3px; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 700; color: #2c3e50; font-size: 8px;">4X BONUS</div>
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px 5px; border-radius: 3px; font-weight: 700; font-size: 8px;">5%</div>
                                </div>
                                <div style="background: white; padding: 3px;">
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px; text-align: center; font-weight: 600; margin-bottom: 2px; border-radius: 2px;">
                                        GOLD DIRECTORS & ABOVE
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                                        <div style="color: #666;">
                                            <div>‚úì Self: 500 BV</div>
                                            <div>‚úì Min 4 legs √ó 10K GBV</div>
                                        </div>
                                        <div style="background: #ff4757; color: white; padding: 2px 4px; border-radius: 2px; font-weight: 700; align-self: flex-start;">
                                            Max: ‚Çπ1,00,000
                                        </div>
                                    </div>
                                    <div style="font-size: 5.5px; color: #888; line-height: 1.2;">
                                        Eligible: Performance 23% ‚Ä¢ Travel 2% ‚Ä¢ 2W 2% ‚Ä¢ 4W 2% ‚Ä¢ Leadership 17% ‚Ä¢ BB 2X 8% ‚Ä¢ BB 3X 8%
                                    </div>
                                </div>
                            </div>

                            <!-- Formula -->
                            <div style="background: #c8b068; padding: 2px; text-align: center; font-weight: 600; color: #2c3e50; border-radius: 2px; font-size: 6px;">
                                Your GBV / Sum of Qualifiers GBV √ó % of CTO
                            </div>
                        </div>
                    </div>

                    <!-- Box 4: Leadership -->
                    <div class="dist-category-box" style="border: 3px solid #4caf50; background: linear-gradient(135deg, #ffffff 0%, #f8fff9 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);">
                            üëë Leadership Bonus
                            <span class="dist-category-total">21%</span>
                        </div>
                        <div style="padding: 6px; max-height: 180px; overflow-y: auto;">
                            <table style="width: 100%; font-size: 8px; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #e8f5e9; position: sticky; top: 0;">
                                        <th style="padding: 3px; text-align: left; border: 1px solid #ddd;">Rank</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">Self</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L1</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L2</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L3</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L4</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L5</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L6</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L7</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L8</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L9</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd;">L10</th>
                                        <th style="padding: 3px; text-align: center; border: 1px solid #ddd; background: #c8e6c9;">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="background: #fef5e7;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">ü•â Bronze</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">13</td>
                                    </tr>
                                    <tr style="background: #fff;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">ü•à Silver</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">15</td>
                                    </tr>
                                    <tr style="background: #fef5e7;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">ü•á Gold</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">17</td>
                                    </tr>
                                    <tr style="background: #fff;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üíé Ruby</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">18</td>
                                    </tr>
                                    <tr style="background: #fef5e7;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üíé Diamond</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">19</td>
                                    </tr>
                                    <tr style="background: #fff;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üíéüíé 2X Diamond</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">19.5</td>
                                    </tr>
                                    <tr style="background: #fef5e7;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üíé Blue</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">20</td>
                                    </tr>
                                    <tr style="background: #fff;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üíé Black</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; color: #ccc;">-</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">20.5</td>
                                    </tr>
                                    <tr style="background: #fef5e7;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üëë Crown</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">21</td>
                                    </tr>
                                    <tr style="background: #fff;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üëë Ambassador</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">21</td>
                                    </tr>
                                    <tr style="background: #fef5e7;">
                                        <td style="padding: 2px 3px; border: 1px solid #ddd; font-weight: 600;">üëë President</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">3</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">2</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">1</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center;">0.5</td>
                                        <td style="padding: 2px; border: 1px solid #ddd; text-align: center; font-weight: 700; background: #c8e6c9;">21</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div style="font-size: 7px; color: #666; margin-top: 3px; text-align: center;">
                                Self = Self Business | L1-L10 = Downline Levels | All % from BV
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Second Row -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px;">
                    <!-- Box 5: Director Fund (Updated) -->
                    <div class="dist-category-box" style="border: 3px solid #ff6b6b; background: linear-gradient(135deg, #ffffff 0%, #fff9f8 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #ee0979 0%, #ff6a00 100%);">
                            üéÅ Director Fund
                            <span class="dist-category-total">4%</span>
                        </div>
                        <div style="padding: 5px; font-size: 6.5px; max-height: 180px; overflow-y: auto;">
                            
                            <!-- Director Level -->
                            <div style="border: 2px solid #e74c3c; border-radius: 4px; margin-bottom: 3px; overflow: hidden;">
                                <div style="background: #e74c3c; padding: 3px; text-align: center;">
                                    <div style="font-weight: 700; color: white; font-size: 8px;">DIRECTOR</div>
                                </div>
                                <div style="background: white; padding: 3px;">
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px; text-align: center; font-weight: 600; margin-bottom: 2px; border-radius: 2px; font-size: 7px;">
                                        QUALIFICATION:
                                    </div>
                                    <div style="color: #2c3e50; line-height: 1.4;">
                                        <div>‚úì Self: 500 BV</div>
                                        <div>‚úì Qualify 23% Performance Level</div>
                                        <div>‚úì Maintain 25,000 GBV in closing month</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bronze Director Level -->
                            <div style="border: 2px solid #cd7f32; border-radius: 4px; margin-bottom: 3px; overflow: hidden;">
                                <div style="background: #cd7f32; padding: 3px; text-align: center;">
                                    <div style="font-weight: 700; color: white; font-size: 8px;">BRONZE DIRECTOR</div>
                                </div>
                                <div style="background: white; padding: 3px;">
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px; text-align: center; font-weight: 600; margin-bottom: 2px; border-radius: 2px; font-size: 7px;">
                                        QUALIFICATION:
                                    </div>
                                    <div style="color: #2c3e50; line-height: 1.4; margin-bottom: 2px;">
                                        <div>‚úì Self: 500 BV</div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>‚úì 25,000 GBV</span>
                                            <span style="background: #e67e22; color: white; padding: 1px 3px; border-radius: 2px; font-size: 6px;">From Qualified Director Leg</span>
                                        </div>
                                        <div>‚úì 20,000 GBV from Non-Qualified Leg (incl. PBV)</div>
                                    </div>
                                    <div style="background: #c8b068; padding: 2px; text-align: center; font-weight: 600; color: #2c3e50; border-radius: 2px; font-size: 6.5px;">
                                        PGBV 20,000 & 25,000 GBV Required from 1 Director & Above Leg
                                    </div>
                                </div>
                            </div>

                            <!-- Silver Director Level -->
                            <div style="border: 2px solid #c0c0c0; border-radius: 4px; margin-bottom: 2px; overflow: hidden;">
                                <div style="background: #c0c0c0; padding: 3px; text-align: center;">
                                    <div style="font-weight: 700; color: #2c3e50; font-size: 8px;">SILVER DIRECTOR</div>
                                </div>
                                <div style="background: white; padding: 3px;">
                                    <div style="background: #2c3e50; color: #ffd700; padding: 2px; text-align: center; font-weight: 600; margin-bottom: 2px; border-radius: 2px; font-size: 7px;">
                                        QUALIFICATION:
                                    </div>
                                    <div style="color: #2c3e50; line-height: 1.4; margin-bottom: 2px;">
                                        <div>‚úì Self: 500 BV</div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>‚úì 25,000 GBV Each</span>
                                            <span style="background: #e67e22; color: white; padding: 1px 3px; border-radius: 2px; font-size: 6px;">From 2 Qualified Directors Legs</span>
                                        </div>
                                        <div>‚úì 15,000 GBV from Non-Qualified Legs (incl. PBV)</div>
                                    </div>
                                    <div style="background: #c8b068; padding: 2px; text-align: center; font-weight: 600; color: #2c3e50; border-radius: 2px; font-size: 6.5px;">
                                        PGBV 15,000 & 25,000 GBV Required From Each of 2 Directors & Above Legs
                                    </div>
                                </div>
                            </div>

                            <!-- Formula -->
                            <div style="background: #ee0979; padding: 2px; text-align: center; font-weight: 600; color: white; border-radius: 2px; font-size: 6px;">
                                Your GBV / Sum of Qualifiers GBV √ó 4% of CTO
                            </div>
                        </div>
                    </div>

                    <!-- Box 6: Vehicle & Lifestyle -->
                    <div class="dist-category-box" style="border: 3px solid #2196f3; background: linear-gradient(135deg, #ffffff 0%, #f8fbff 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #00c6ff 0%, #0072ff 100%);">
                            üöó Vehicle & Lifestyle
                            <span class="dist-category-total">12%</span>
                        </div>
                        <div class="dist-mini-items">
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Travel Fund</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 16.67%; background: #ff6a00;"></div>
                                </div>
                                <span class="dist-mini-value">2%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">2 Wheeler</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 16.67%; background: #00c6ff;"></div>
                                </div>
                                <span class="dist-mini-value">2%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">4 Wheeler</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 16.67%; background: #2193b0;"></div>
                                </div>
                                <span class="dist-mini-value">2%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">House</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 16.67%; background: #cc2b5e;"></div>
                                </div>
                                <span class="dist-mini-value">2%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Life Style</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 33.33%; background: #42275a;"></div>
                                </div>
                                <span class="dist-mini-value">4%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Box 7: Diamond & Elite Funds (Merged) -->
                    <div class="dist-category-box" style="border: 3px solid #9c27b0; background: linear-gradient(135deg, #ffffff 0%, #fcf8ff 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #bc4e9c 0%, #f80759 100%);">
                            üíé Diamond & Elite
                            <span class="dist-category-total">7%</span>
                        </div>
                        <div class="dist-mini-items">
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Doubleüíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 28.57%; background: #bc4e9c;"></div>
                                </div>
                                <span class="dist-mini-value">2%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Blueüíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 14.29%; background: #4568dc;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Blacküíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 14.29%; background: #434343;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Crownüíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 14.29%; background: #ffd700;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Ambassadorüëë</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 14.29%; background: #f46b45;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Presidentüëë</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 14.29%; background: #fc4a1a;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Box 8: Annual Royalty -->
                    <div class="dist-category-box" style="border: 3px solid #e91e63; background: linear-gradient(135deg, #ffffff 0%, #fff8fa 100%);">
                        <div class="dist-category-header" style="background: linear-gradient(90deg, #eb3349 0%, #f45c43 100%);">
                            ‚≠ê Annual Royalty
                            <span class="dist-category-total">5%</span>
                        </div>
                        <div class="dist-mini-items">
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Doubleüíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 20%; background: #eb3349;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Blueüíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 20%; background: #4568dc;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Blacküíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 20%; background: #2c3e50;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Crownüíé</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 20%; background: #ffd700;"></div>
                                </div>
                                <span class="dist-mini-value">1%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Ambassadorüëë</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 10%; background: #f46b45;"></div>
                                </div>
                                <span class="dist-mini-value">0.5%</span>
                            </div>
                            <div class="dist-mini-item">
                                <span class="dist-mini-label">Presidentüëë</span>
                                <div class="dist-mini-bar-container">
                                    <div class="dist-mini-bar" style="width: 10%; background: #fc4a1a;"></div>
                                </div>
                                <span class="dist-mini-value">0.5%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Fill -->
            <div class="quick-fill">
                <button class="quick-fill-btn" onclick="fillBasicPlan()">üìù Basic Plan</button>
                <button class="quick-fill-btn" onclick="fillBasicTeamPlan()">üë• Basic Team Plan</button>
                <button class="quick-fill-btn" onclick="fillLearningPlan()">üìö Learning Plan</button>
                <button class="quick-fill-btn" onclick="fillLearningTeamPlan()">üéì Learning Team Plan</button>
                <button class="quick-fill-btn" onclick="fillDigitalClinicPlan()">üè• Digital Clinic Plan</button>
                <button class="quick-fill-btn" onclick="fillDigitalClinicTeamPlan()">üè•üë• Digital Clinic Team Plan</button>
                <button class="quick-fill-btn" onclick="fillCTOBonusTestPlan()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 2px solid #fff; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">üí∞ CTO Bonus Test Plan</button>
            </div>

            <!-- Main Planning Table -->
            <div class="section-title">üìÖ 12-Month Accumulative Business Plan</div>
            <div class="table-wrapper">
                <table id="planTable"></table>
            </div>

            <!-- Group BV Display -->
            <div class="group-bv-section">
                <h3 class="group-bv-title">üìä Individual Group Business Volume (Cumulative)</h3>
                <div class="group-bv-grid">
                    <div class="group-bv-card">
                        <h4>G1 - Group 1</h4>
                        <div class="bv-amount" id="g1TotalBV">‚Çπ 0</div>
                    </div>
                    <div class="group-bv-card">
                        <h4>G2 - Group 2</h4>
                        <div class="bv-amount" id="g2TotalBV">‚Çπ 0</div>
                    </div>
                    <div class="group-bv-card">
                        <h4>G3 - Group 3</h4>
                        <div class="bv-amount" id="g3TotalBV">‚Çπ 0</div>
                    </div>
                    <div class="group-bv-card">
                        <h4>G4 - Group 4</h4>
                        <div class="bv-amount" id="g4TotalBV">‚Çπ 0</div>
                    </div>
                    <div class="group-bv-card">
                        <h4>G5 - Group 5 (Optional)</h4>
                        <div class="bv-amount" id="g5TotalBV">‚Çπ 0</div>
                    </div>
                </div>
            </div>

            <!-- Performance Bonus Section - HORIZONTAL LAYOUT -->
            <div class="performance-section">
                <h3 class="performance-title">üìà Performance Bonus Calculator</h3>
                <p class="performance-subtitle">‡§ú‡•à‡§∏‡•á PDF Page 5 ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à | ‡§ï‡•á‡§µ‡§≤ Last Entered Month ‡§ï‡§æ Calculation ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à</p>
                
                <div class="performance-horizontal">
                    <!-- Main Person (You) with Dynamic Rate -->
                    <div class="perf-main-person">
                        <h4 id="yourHeader">üë§ ‡§Ü‡§™ (YOU) - 5%</h4>
                        <div class="perf-main-inputs">
                            <div class="perf-input-item">
                                <label id="selfBVMonthLabel">Self BV (Month 1)</label>
                                <input type="number" id="perfPBV" placeholder="0" disabled style="background: #f5f5f5;">
                            </div>
                            <div class="perf-input-item">
                                <label id="monthGBVLabel">Monthly GBV (Month 1)</label>
                                <input type="number" id="perfYourGBV" placeholder="0" disabled style="background: #f5f5f5;">
                            </div>
                            <div class="perf-input-item">
                                <label>Your Rate (Auto)</label>
                                <input type="number" id="perfYourRate" value="5" disabled style="background: #e0e0e0;">
                            </div>
                        </div>
                    </div>

                    <!-- Groups G1 to G5 - Horizontal Row with Dynamic Rates -->
                    <div class="perf-associates-row">
                        <!-- Group G1 -->
                        <div class="perf-associate-card">
                            <h5 id="g1Header">G1 - 5%</h5>
                            <div class="perf-associate-inputs">
                                <div class="perf-assoc-input-row">
                                    <label id="g1GBVLabel">Monthly GBV</label>
                                    <input type="number" id="perfG1GBV" value="0" disabled>
                                </div>
                                <div class="perf-rate-display" id="g1RateInfo">Rate: 5%</div>
                            </div>
                        </div>

                        <!-- Group G2 -->
                        <div class="perf-associate-card">
                            <h5 id="g2Header">G2 - 5%</h5>
                            <div class="perf-associate-inputs">
                                <div class="perf-assoc-input-row">
                                    <label id="g2GBVLabel">Monthly GBV</label>
                                    <input type="number" id="perfG2GBV" value="0" disabled>
                                </div>
                                <div class="perf-rate-display" id="g2RateInfo">Rate: 5%</div>
                            </div>
                        </div>

                        <!-- Group G3 -->
                        <div class="perf-associate-card">
                            <h5 id="g3Header">G3 - 5%</h5>
                            <div class="perf-associate-inputs">
                                <div class="perf-assoc-input-row">
                                    <label id="g3GBVLabel">Monthly GBV</label>
                                    <input type="number" id="perfG3GBV" value="0" disabled>
                                </div>
                                <div class="perf-rate-display" id="g3RateInfo">Rate: 5%</div>
                            </div>
                        </div>

                        <!-- Group G4 -->
                        <div class="perf-associate-card">
                            <h5 id="g4Header">G4 - 5%</h5>
                            <div class="perf-associate-inputs">
                                <div class="perf-assoc-input-row">
                                    <label id="g4GBVLabel">Monthly GBV</label>
                                    <input type="number" id="perfG4GBV" value="0" disabled>
                                </div>
                                <div class="perf-rate-display" id="g4RateInfo">Rate: 5%</div>
                            </div>
                        </div>

                        <!-- Group G5 (Optional) -->
                        <div class="perf-associate-card">
                            <h5 id="g5Header">G5 - 5%</h5>
                            <div class="perf-associate-inputs">
                                <div class="perf-assoc-input-row">
                                    <label id="g5GBVLabel">Monthly GBV</label>
                                    <input type="number" id="perfG5GBV" value="0" disabled>
                                </div>
                                <div class="perf-rate-display" id="g5RateInfo">Rate: 5%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Result -->
                    <div class="performance-result">
                        <h3 id="perfBonusTitle">üí∞ Total Performance Bonus Income (Month 1)</h3>
                        <div class="amount" id="perfTotalIncome">‚Çπ 8,015</div>
                        
                        <div class="performance-breakdown">
                            <div class="breakdown-item">
                                <div class="label">Your Income</div>
                                <div class="value" id="perfYourIncome">‚Çπ 115</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="label">From G1</div>
                                <div class="value" id="perfG1Income">‚Çπ 0</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="label">From G2</div>
                                <div class="value" id="perfG2Income">‚Çπ 0</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="label">From G3</div>
                                <div class="value" id="perfG3Income">‚Çπ 0</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="label">From G4</div>
                                <div class="value" id="perfG4Income">‚Çπ 0</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="label">From G5</div>
                                <div class="value" id="perfG5Income">‚Çπ 0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- INCOME BREAKDOWN DISPLAY -->
                <div id="incomeCalculationBreakdown" style="margin-top: 25px;"></div>
            </div>

            <!-- Summary Card -->
            <div class="summary-card" id="summaryCard"></div>

            <!-- Detailed Income Breakdown -->
            <div class="section-title">üí∞ Detailed Income Breakdown (Live)</div>
            <div class="income-grid" id="incomeBreakdown"></div>
        </div>
    </div>

    <script>
        // Initialize table
        function initializeTable() {
            let html = `
                <tr>
                    <th rowspan="2">Month</th>
                    <th rowspan="2">Self DP<br>(Input DP)</th>
                    <th rowspan="2">DP BV<br>(<span id="headerDpToBvRate">30</span>%)</th>
                    <th colspan="5">Group BV Input (G1, G2, G3, G4, G5)</th>
                    <th rowspan="2">Monthly<br>GBV</th>
                    <th rowspan="2">Cumulative<br>GBV</th>
                    <th rowspan="2">Rank</th>
                    <th rowspan="2">Monthly<br>Income</th>
                </tr>
                <tr>
                    <th>G1 BV</th>
                    <th>G2 BV</th>
                    <th>G3 BV</th>
                    <th>G4 BV</th>
                    <th>G5 BV<br>(Optional)</th>
                </tr>
            `;

            for (let month = 1; month <= 12; month++) {
                html += `
                    <tr>
                        <td class="month-cell">Month ${month}</td>
                        <td><input type="number" class="self-dp" data-month="${month}" placeholder="0" onchange="calculateAll()"></td>
                        <td class="result-cell" id="dpBV${month}">0</td>
                        <td><input type="number" class="leg1" data-month="${month}" placeholder="0" onchange="calculateAll()"></td>
                        <td><input type="number" class="leg2" data-month="${month}" placeholder="0" onchange="calculateAll()"></td>
                        <td><input type="number" class="leg3" data-month="${month}" placeholder="0" onchange="calculateAll()"></td>
                        <td><input type="number" class="leg4" data-month="${month}" placeholder="0" onchange="calculateAll()"></td>
                        <td><input type="number" class="leg5" data-month="${month}" placeholder="0" onchange="calculateAll()"></td>
                        <td class="result-cell" id="monthlyGbv${month}">0</td>
                        <td class="result-cell" id="cumulativeGbv${month}">0</td>
                        <td class="rank-cell" id="rank${month}">-</td>
                        <td class="result-cell" id="income${month}">‚Çπ 0</td>
                    </tr>
                `;
            }

            document.getElementById('planTable').innerHTML = html;
        }

        // Calculate all with debouncing for fast input
        let calculateTimeout;
        // IMPORTANT FUNCTION: Updates all percentage displays throughout the interface
        // This function ensures visual consistency when user changes Calculator Settings
        // It reads current values from settings and updates all display elements
        function updatePercentageDisplays() {
            // Get current percentage values from Calculator Settings fields
            const retailMarginRate = parseFloat(document.getElementById('retailMargin').value) || 30;
            const dpToBvRate = parseFloat(document.getElementById('dpToBvRate').value) || 30;
            const directorRate = parseFloat(document.getElementById('directorFundRate').value) || 4;
            const royaltyRate = parseFloat(document.getElementById('royaltyRate').value) || 5;
            
            // Update table header for DP BV column so it shows current conversion rate
            const headerElement = document.getElementById('headerDpToBvRate');
            if (headerElement) {
                headerElement.textContent = dpToBvRate;
            }
            
            // Store these rates globally so they can be accessed by display generation functions
            // This eliminates the need to repeatedly fetch them from DOM
            window.currentDisplayRates = {
                retailMargin: retailMarginRate,
                dpToBv: dpToBvRate,
                director: directorRate,
                royalty: royaltyRate
            };
        }

        function calculateAll() {
            clearTimeout(calculateTimeout);
            calculateTimeout = setTimeout(() => {
                // First, update all percentage displays to match current settings
                updatePercentageDisplays();
                // Then perform the actual calculations
                performCalculation();
            }, 100);
        }

        function performCalculation() {
            // Get dynamic DP to BV conversion rate from Calculator Settings
            const dpToBvRate = parseFloat(document.getElementById('dpToBvRate').value) || 30;
            const dpToBvDecimal = dpToBvRate / 100; // Convert percentage to decimal
            
            let cumulative = {
                dpBV: 0,
                leg1: 0,
                leg2: 0,
                leg3: 0,
                leg4: 0,
                leg5: 0,
                total: 0
            };

            let totalIncome = 0;
            let allMonthsData = []; // Store data for all 12 months

            // Process each month
            for (let month = 1; month <= 12; month++) {
                const selfDp = parseFloat(document.querySelector(`.self-dp[data-month="${month}"]`).value) || 0;
                const leg1 = parseFloat(document.querySelector(`.leg1[data-month="${month}"]`).value) || 0;
                const leg2 = parseFloat(document.querySelector(`.leg2[data-month="${month}"]`).value) || 0;
                const leg3 = parseFloat(document.querySelector(`.leg3[data-month="${month}"]`).value) || 0;
                const leg4 = parseFloat(document.querySelector(`.leg4[data-month="${month}"]`).value) || 0;
                const leg5 = parseFloat(document.querySelector(`.leg5[data-month="${month}"]`).value) || 0;

                // Use dynamic DP to BV conversion rate from settings
                const dpBV = selfDp * dpToBvDecimal;
                const monthlyGbv = dpBV + leg1 + leg2 + leg3 + leg4 + leg5;

                cumulative.dpBV += dpBV;
                cumulative.leg1 += leg1;
                cumulative.leg2 += leg2;
                cumulative.leg3 += leg3;
                cumulative.leg4 += leg4;
                cumulative.leg5 += leg5;
                cumulative.total += monthlyGbv;

                const rank = determineRank(cumulative.total);
                const monthlyIncome = calculateMonthlyIncome(selfDp, dpBV, monthlyGbv, cumulative.total, rank, month);
                totalIncome += monthlyIncome;

                document.getElementById(`dpBV${month}`).textContent = dpBV.toFixed(0);
                document.getElementById(`monthlyGbv${month}`).textContent = monthlyGbv.toLocaleString('en-IN');
                document.getElementById(`cumulativeGbv${month}`).textContent = cumulative.total.toLocaleString('en-IN');
                document.getElementById(`rank${month}`).textContent = rank;
                document.getElementById(`income${month}`).textContent = `‚Çπ ${Math.round(monthlyIncome).toLocaleString('en-IN')}`;

                // Store data for this month if it has any values
                if (selfDp > 0 || leg1 > 0 || leg2 > 0 || leg3 > 0 || leg4 > 0 || leg5 > 0) {
                    allMonthsData.push({
                        month: month,
                        selfDp,
                        dpBV,
                        monthlyGbv,
                        cumulativeGbv: cumulative.total,
                        rank
                    });
                }
            }

            // Update individual group BV totals
            document.getElementById('g1TotalBV').textContent = `‚Çπ ${cumulative.leg1.toLocaleString('en-IN')}`;
            document.getElementById('g2TotalBV').textContent = `‚Çπ ${cumulative.leg2.toLocaleString('en-IN')}`;
            document.getElementById('g3TotalBV').textContent = `‚Çπ ${cumulative.leg3.toLocaleString('en-IN')}`;
            document.getElementById('g4TotalBV').textContent = `‚Çπ ${cumulative.leg4.toLocaleString('en-IN')}`;
            document.getElementById('g5TotalBV').textContent = `‚Çπ ${cumulative.leg5.toLocaleString('en-IN')}`;

            // AUTO-SYNC: Update Performance Bonus Calculator with LAST MONTH's data
            // Pass the last month's data for calculating performance bonus
            const lastMonthData = allMonthsData.length > 0 ? allMonthsData[allMonthsData.length - 1] : null;
            syncGroupBVToPerformanceCalculator(cumulative, lastMonthData);

            updateSummary(cumulative, totalIncome, allMonthsData[allMonthsData.length - 1] || null);
            updateIncomeBreakdown(allMonthsData, cumulative);
        }

        // NEW FUNCTION: Get Performance Rate based on GBV (PDF Page 4 Slab Chart)
        function getRateFromGBV(gbv) {
            if (gbv >= 80001) return 23;
            if (gbv >= 40001) return 19;
            if (gbv >= 20001) return 15;
            if (gbv >= 5001) return 11;
            return 5; // 0 - 5000 GBV
        }

        // UPDATED FUNCTION: Auto-sync with LAST MONTH's data only
        function syncGroupBVToPerformanceCalculator(cumulative, lastMonthData) {
            // Get the last month number that has data
            const lastMonth = lastMonthData ? lastMonthData.month : 0;
            
            // Get dynamic DP to BV conversion rate
            const dpToBvRate = parseFloat(document.getElementById('dpToBvRate').value) || 30;
            const dpToBvDecimal = dpToBvRate / 100;
            
            // Get LAST MONTH's Self DP and calculate Self BV
            const lastMonthSelfDP = lastMonthData ? lastMonthData.selfDp : 0;
            const lastMonthSelfBV = Math.round(lastMonthSelfDP * dpToBvDecimal);
            
            // Get LAST MONTH's Group BVs (from the table inputs for that month)
            const lastMonthG1 = lastMonth > 0 ? (parseFloat(document.querySelector(`.leg1[data-month="${lastMonth}"]`).value) || 0) : 0;
            const lastMonthG2 = lastMonth > 0 ? (parseFloat(document.querySelector(`.leg2[data-month="${lastMonth}"]`).value) || 0) : 0;
            const lastMonthG3 = lastMonth > 0 ? (parseFloat(document.querySelector(`.leg3[data-month="${lastMonth}"]`).value) || 0) : 0;
            const lastMonthG4 = lastMonth > 0 ? (parseFloat(document.querySelector(`.leg4[data-month="${lastMonth}"]`).value) || 0) : 0;
            const lastMonthG5 = lastMonth > 0 ? (parseFloat(document.querySelector(`.leg5[data-month="${lastMonth}"]`).value) || 0) : 0;
            
            // Calculate LAST MONTH's Total GBV
            const lastMonthTotalGBV = lastMonthSelfBV + lastMonthG1 + lastMonthG2 + lastMonthG3 + lastMonthG4 + lastMonthG5;
            
            // Update labels with month number
            document.getElementById('selfBVMonthLabel').textContent = `Self BV (Month ${lastMonth || 1})`;
            document.getElementById('monthGBVLabel').textContent = `Monthly GBV (Month ${lastMonth || 1})`;
            document.getElementById('perfBonusTitle').textContent = `üí∞ Total Performance Bonus Income (Month ${lastMonth || 1})`;
            
            // Update PBV with LAST MONTH's Self BV
            document.getElementById('perfPBV').value = Math.round(lastMonthSelfBV);
            
            // Update Your GBV with LAST MONTH's Total GBV
            document.getElementById('perfYourGBV').value = Math.round(lastMonthTotalGBV);
            
            // Calculate Your Rate based on LAST MONTH's Total GBV
            const yourRate = getRateFromGBV(lastMonthTotalGBV);
            document.getElementById('perfYourRate').value = yourRate;
            
            // Update Your header with dynamic rate
            document.getElementById('yourHeader').textContent = `üë§ ‡§Ü‡§™ (YOU) - ${yourRate}%`;
            
            // Update Group GBV values with LAST MONTH's data
            document.getElementById('perfG1GBV').value = Math.round(lastMonthG1);
            document.getElementById('perfG2GBV').value = Math.round(lastMonthG2);
            document.getElementById('perfG3GBV').value = Math.round(lastMonthG3);
            document.getElementById('perfG4GBV').value = Math.round(lastMonthG4);
            document.getElementById('perfG5GBV').value = Math.round(lastMonthG5);
            
            // Calculate and update rates based on each group's GBV for LAST MONTH
            const g1Rate = getRateFromGBV(lastMonthG1);
            const g2Rate = getRateFromGBV(lastMonthG2);
            const g3Rate = getRateFromGBV(lastMonthG3);
            const g4Rate = getRateFromGBV(lastMonthG4);
            const g5Rate = getRateFromGBV(lastMonthG5);
            
            // Update headers with dynamic rates
            document.getElementById('g1Header').textContent = `G1 - ${g1Rate}%`;
            document.getElementById('g2Header').textContent = `G2 - ${g2Rate}%`;
            document.getElementById('g3Header').textContent = `G3 - ${g3Rate}%`;
            document.getElementById('g4Header').textContent = `G4 - ${g4Rate}%`;
            document.getElementById('g5Header').textContent = `G5 - ${g5Rate}%`;
            
            // Update rate info displays
            document.getElementById('g1RateInfo').textContent = `Rate: ${g1Rate}% (GBV: ‚Çπ${lastMonthG1.toLocaleString('en-IN')})`;
            document.getElementById('g2RateInfo').textContent = `Rate: ${g2Rate}% (GBV: ‚Çπ${lastMonthG2.toLocaleString('en-IN')})`;
            document.getElementById('g3RateInfo').textContent = `Rate: ${g3Rate}% (GBV: ‚Çπ${lastMonthG3.toLocaleString('en-IN')})`;
            document.getElementById('g4RateInfo').textContent = `Rate: ${g4Rate}% (GBV: ‚Çπ${lastMonthG4.toLocaleString('en-IN')})`;
            document.getElementById('g5RateInfo').textContent = `Rate: ${g5Rate}% (GBV: ‚Çπ${lastMonthG5.toLocaleString('en-IN')})`;
            
            // Store cumulative data for later use
            window.cumulativeData = cumulative;
            window.lastMonthNumber = lastMonth;
            
            // Recalculate performance bonus with new values
            calculatePerformanceBonus();
        }

        // UPDATED FUNCTION: Performance Bonus Calculator - Shows last entered month's Self BV
        function calculatePerformanceBonus() {
            // Get dynamic rates from Calculator Settings
            const dpToBvRate = parseFloat(document.getElementById('dpToBvRate').value) || 30;
            const dpToBvDecimal = dpToBvRate / 100; // Convert percentage to decimal
            const retailMarginRate = parseFloat(document.getElementById('retailMargin').value) || 30;
            const retailMarginDecimal = retailMarginRate / 100; // Convert percentage to decimal
            
            // Find the highest month number that has Self DP data entered
            let highestMonthWithData = 0;
            let highestMonthSelfDP = 0;
            
            for (let month = 12; month >= 1; month--) {
                const monthSelfDP = parseFloat(document.querySelector(`.self-dp[data-month="${month}"]`).value) || 0;
                if (monthSelfDP > 0) {
                    highestMonthWithData = month;
                    highestMonthSelfDP = monthSelfDP;
                    break; // Found the highest month with data, exit loop
                }
            }
            
            // Calculate Self BV for ONLY the last entered month (for performance bonus calculation)
            // This represents the specific month's Self BV for performance calculation
            const lastMonthSelfBV = Math.round(highestMonthSelfDP * dpToBvDecimal);
            
            // Calculate CUMULATIVE Self DP from month 1 up to the highest month (for retail margin calculation)
            let totalSelfDP = 0;
            for (let month = 1; month <= highestMonthWithData; month++) {
                const monthSelfDP = parseFloat(document.querySelector(`.self-dp[data-month="${month}"]`).value) || 0;
                totalSelfDP += monthSelfDP;
            }
            
            // Also calculate CUMULATIVE Self BV for display purposes in breakdown section
            const totalSelfBV = Math.round(totalSelfDP * dpToBvDecimal);
            
            // IMPORTANT: Calculate month-by-month performance bonus for accurate total income
            // Each month's bonus is based on that month's cumulative achievement level
            let monthlyBreakdown = [];
            let cumulativeSelfBV = 0;
            let cumulativeGroupBV = 0;
            let totalMonthlyPerformanceBonus = 0;
            
            // Get cumulative Group BVs from Performance Calculator fields
            const totalG1GBV = parseFloat(document.getElementById('perfG1GBV').value) || 0;
            const totalG2GBV = parseFloat(document.getElementById('perfG2GBV').value) || 0;
            const totalG3GBV = parseFloat(document.getElementById('perfG3GBV').value) || 0;
            const totalG4GBV = parseFloat(document.getElementById('perfG4GBV').value) || 0;
            const totalG5GBV = parseFloat(document.getElementById('perfG5GBV').value) || 0;
            
            // For simplicity, we'll assume Group BVs grow proportionally each month
            // (In real scenario, you'd have month-by-month group data)
            const totalGroupBV = totalG1GBV + totalG2GBV + totalG3GBV + totalG4GBV + totalG5GBV;
            
            // Variables to track bonus totals across all months
            let totalRepurchaseBonus = 0;
            let totalLoyaltyBonus = 0;
            
            // PRE-SCAN: Determine which specific months qualify for Loyalty/Super Loyalty Bonuses
            // These bonuses are NOT awarded every month, but only in specific qualifying months
            // based on consecutive achievement windows
            
            const loyaltyAwardedMonths = [];
            const superLoyalty5AwardedMonths = [];
            const superLoyalty12AwardedMonths = [];
            
            // Helper function to check if amount is valid for Loyalty Bonus
            function isValidLoyaltyAmount(amount) {
                return amount >= 1500 && amount < 48000 && amount % 1500 === 0;
            }
            
            // Collect all months data for scanning
            const allMonthsForScan = [];
            for (let month = 1; month <= highestMonthWithData; month++) {
                const selfDP = parseFloat(document.querySelector(`.self-dp[data-month="${month}"]`).value) || 0;
                allMonthsForScan.push({ month: month, selfDp: selfDP });
            }
            
            // STEP 1: Scan for Super Loyalty 12-month bonus (awards in Month 12 if all 12 months ‚â•48000)
            if (allMonthsForScan.length === 12) {
                let all48k = true;
                for (let i = 0; i < 12; i++) {
                    if (allMonthsForScan[i].selfDp < 48000) {
                        all48k = false;
                        break;
                    }
                }
                if (all48k) {
                    superLoyalty12AwardedMonths.push({ month: 12, amount: 96000 });
                }
            }
            
            // STEP 2: Scan for Super Loyalty 5-month bonuses (awards after 5 consecutive months ‚â•48000)
            let lastSuper5Award = -1;
            for (let i = 5; i < allMonthsForScan.length; i++) {
                // Check if 12-month bonus is being awarded in this month
                const has12MonthHere = superLoyalty12AwardedMonths.some(award => award.month === (i + 1));
                if (has12MonthHere) continue;
                
                let consecutive48k = true;
                let canAward = true;
                
                // Check if previous 5 months all have ‚â•48000
                for (let j = i - 4; j <= i; j++) {
                    if (j <= lastSuper5Award) {
                        canAward = false;
                        break;
                    }
                    if (allMonthsForScan[j].selfDp < 48000) {
                        consecutive48k = false;
                        break;
                    }
                }
                
                if (canAward && consecutive48k) {
                    superLoyalty5AwardedMonths.push({ month: (i + 1), amount: 48000 });
                    lastSuper5Award = i;
                }
            }
            
            // STEP 3: Scan for Loyalty Bonus awards
            // 6-month milestone: Award in 6th month with base amount + 30% retail margin
            // 12-month milestone: Award in 12th month with double amount + 30% retail margin
            let lastLoyaltyAward = -1;
            
            const loyalty6AwardedMonths = [];
            const loyalty12AwardedMonths = [];
            
            // First scan for 12-month Loyalty Bonus (higher priority)
            if (allMonthsForScan.length >= 12) {
                for (let i = 11; i < allMonthsForScan.length; i++) {
                    // Check if Super Loyalty was awarded in this window
                    const superAwardedInWindow = superLoyalty5AwardedMonths.some(award => award.month >= (i - 10) && award.month <= (i + 1)) ||
                                                 superLoyalty12AwardedMonths.some(award => award.month >= (i - 10) && award.month <= (i + 1));
                    if (superAwardedInWindow) continue;
                    
                    let consecutiveQualifying = 0;
                    let minAmount = Infinity;
                    let canAward = true;
                    let hasLargeAmount = false;
                    
                    // Check previous 12 months
                    for (let j = i - 11; j <= i; j++) {
                        if (j <= lastLoyaltyAward) {
                            canAward = false;
                            break;
                        }
                        
                        const monthAmount = allMonthsForScan[j].selfDp;
                        
                        // If any month has ‚â•48000, disqualify this window
                        if (monthAmount >= 48000) {
                            hasLargeAmount = true;
                            canAward = false;
                            break;
                        }
                        
                        if (isValidLoyaltyAmount(monthAmount)) {
                            consecutiveQualifying++;
                            minAmount = Math.min(minAmount, monthAmount);
                        } else {
                            canAward = false;
                            break;
                        }
                    }
                    
                    if (canAward && consecutiveQualifying === 12 && !hasLargeAmount) {
                        loyalty12AwardedMonths.push({ 
                            month: (i + 1), 
                            amount: minAmount * 2  // Double the amount for 12-month
                        });
                        lastLoyaltyAward = i;
                    }
                }
            }
            
            // Then scan for 6-month Loyalty Bonus
            for (let i = 5; i < allMonthsForScan.length; i++) {
                // Check if Super Loyalty or 12-month Loyalty was awarded in this month
                const alreadyAwarded = superLoyalty5AwardedMonths.some(award => award.month === (i + 1)) ||
                                      superLoyalty12AwardedMonths.some(award => award.month === (i + 1)) ||
                                      loyalty12AwardedMonths.some(award => award.month === (i + 1));
                if (alreadyAwarded) continue;
                
                let consecutiveQualifying = 0;
                let minAmount = Infinity;
                let canAward = true;
                let hasLargeAmount = false;
                
                // Check previous 6 months
                for (let j = i - 5; j <= i; j++) {
                    if (j <= lastLoyaltyAward) {
                        canAward = false;
                        break;
                    }
                    
                    const monthAmount = allMonthsForScan[j].selfDp;
                    
                    // If any month has ‚â•48000, disqualify this window
                    if (monthAmount >= 48000) {
                        hasLargeAmount = true;
                        canAward = false;
                        break;
                    }
                    
                    if (isValidLoyaltyAmount(monthAmount)) {
                        consecutiveQualifying++;
                        minAmount = Math.min(minAmount, monthAmount);
                    } else {
                        canAward = false;
                        break;
                    }
                }
                
                if (canAward && consecutiveQualifying === 6 && !hasLargeAmount) {
                    loyalty6AwardedMonths.push({ 
                        month: (i + 1), 
                        amount: minAmount  // Base amount for 6-month
                    });
                    lastLoyaltyAward = i;
                }
            }
            
            // Calculate each month's contribution
            for (let month = 1; month <= highestMonthWithData; month++) {
                const monthSelfDP = parseFloat(document.querySelector(`.self-dp[data-month="${month}"]`).value) || 0;
                const monthSelfBV = Math.round(monthSelfDP * dpToBvDecimal);
                
                // Add to cumulative for display purposes
                cumulativeSelfBV += monthSelfBV;
                
                // Calculate THIS MONTH'S Group BV (not cumulative)
                const monthGroupBV = Math.round(totalGroupBV / highestMonthWithData);
                
                // Calculate THIS MONTH'S Total GBV (Self BV + Group BV for this month only)
                const monthTotalGBV = monthSelfBV + monthGroupBV;
                
                // Estimate cumulative GBV for display
                const monthCumulativeGBV = cumulativeSelfBV + Math.round((totalGroupBV / highestMonthWithData) * month);
                
                // Determine performance rate based on THIS MONTH'S GBV (not cumulative)
                let monthPerfRate = 0;
                if (monthTotalGBV >= 80001) monthPerfRate = 23;
                else if (monthTotalGBV >= 40001) monthPerfRate = 19;
                else if (monthTotalGBV >= 20001) monthPerfRate = 15;
                else if (monthTotalGBV >= 5001) monthPerfRate = 11;
                else if (monthTotalGBV >= 0) monthPerfRate = 5;
                
                // Calculate this month's performance bonus on this month's Self BV with this month's rate
                const monthPerformanceBonus = Math.round((monthSelfBV * monthPerfRate) / 100);
                
                // Add to total
                totalMonthlyPerformanceBonus += monthPerformanceBonus;
                
                // Calculate this month's Retail Margin (on Self DP)
                const monthRetailMargin = Math.round(monthSelfDP * retailMarginDecimal);
                
                // Check if this month qualifies for Repurchase Bonus (Self DP >= 48000)
                let monthRepurchaseBonus = 0;
                let repurchaseBaseAmount = 0;
                let repurchaseRetailProfit = 0;
                let repurchaseQualified = false;
                
                if (monthSelfDP >= 48000) {
                    repurchaseQualified = true;
                    repurchaseBaseAmount = 8450;
                    repurchaseRetailProfit = Math.round(repurchaseBaseAmount * retailMarginDecimal);
                    monthRepurchaseBonus = repurchaseBaseAmount + repurchaseRetailProfit;
                    totalRepurchaseBonus += monthRepurchaseBonus;
                }
                
                // Check if Loyalty or Super Loyalty Bonus is awarded in THIS specific month
                // IMPORTANT: Loyalty Bonuses work like Super Loyalty - milestone-based awards
                // They are only given in the specific month when milestone is achieved
                // NOT given every month (unlike Retail Margin or Performance Bonus)
                // (These are pre-determined based on consecutive achievement windows)
                let monthLoyaltyBonus = 0;
                let loyaltyBaseAmount = 0;
                let loyaltyRetailProfit = 0;
                let loyaltyQualified = false;
                let loyaltyType = ''; // 'loyalty', 'super_loyalty_5', or 'super_loyalty_12'
                
                // Check if Super Loyalty 12-month bonus is awarded this month
                const super12Award = superLoyalty12AwardedMonths.find(award => award.month === month);
                if (super12Award) {
                    loyaltyQualified = true;
                    loyaltyType = 'super_loyalty_12';
                    loyaltyBaseAmount = super12Award.amount;
                    loyaltyRetailProfit = Math.round(loyaltyBaseAmount * retailMarginDecimal);
                    monthLoyaltyBonus = loyaltyBaseAmount + loyaltyRetailProfit;
                    totalLoyaltyBonus += monthLoyaltyBonus;
                }
                // Check if Super Loyalty 5-month bonus is awarded this month
                else {
                    const super5Award = superLoyalty5AwardedMonths.find(award => award.month === month);
                    if (super5Award) {
                        loyaltyQualified = true;
                        loyaltyType = 'super_loyalty_5';
                        loyaltyBaseAmount = super5Award.amount;
                        loyaltyRetailProfit = Math.round(loyaltyBaseAmount * retailMarginDecimal);
                        monthLoyaltyBonus = loyaltyBaseAmount + loyaltyRetailProfit;
                        totalLoyaltyBonus += monthLoyaltyBonus;
                    }
                    // Check if regular Loyalty 12-month bonus is awarded this month
                    else {
                        const loyalty12Award = loyalty12AwardedMonths.find(award => award.month === month);
                        if (loyalty12Award) {
                            loyaltyQualified = true;
                            loyaltyType = 'loyalty_12';
                            loyaltyBaseAmount = loyalty12Award.amount;
                            // 30% retail margin for 12-month Loyalty Bonus
                            loyaltyRetailProfit = Math.round(loyaltyBaseAmount * 0.30);
                            monthLoyaltyBonus = loyaltyBaseAmount + loyaltyRetailProfit;
                            totalLoyaltyBonus += monthLoyaltyBonus;
                        }
                        // Check if regular Loyalty 6-month bonus is awarded this month
                        else {
                            const loyalty6Award = loyalty6AwardedMonths.find(award => award.month === month);
                            if (loyalty6Award) {
                                loyaltyQualified = true;
                                loyaltyType = 'loyalty_6';
                                loyaltyBaseAmount = loyalty6Award.amount;
                                // 30% retail margin for 6-month Loyalty Bonus
                                loyaltyRetailProfit = Math.round(loyaltyBaseAmount * 0.30);
                                monthLoyaltyBonus = loyaltyBaseAmount + loyaltyRetailProfit;
                                totalLoyaltyBonus += monthLoyaltyBonus;
                            }
                        }
                    }
                }
                
                // Calculate TOTAL INCOME for this month (all components combined)
                const monthTotalIncome = monthRetailMargin + monthPerformanceBonus + monthRepurchaseBonus + monthLoyaltyBonus;
                
                // Store breakdown for display
                monthlyBreakdown.push({
                    month: month,
                    selfDP: monthSelfDP,
                    selfBV: monthSelfBV,
                    monthlyGBV: monthTotalGBV,
                    cumulativeGBV: monthCumulativeGBV,
                    perfRate: monthPerfRate,
                    retailMargin: monthRetailMargin,
                    performanceBonus: monthPerformanceBonus,
                    repurchaseQualified: repurchaseQualified,
                    repurchaseBaseAmount: repurchaseBaseAmount,
                    repurchaseRetailProfit: repurchaseRetailProfit,
                    repurchaseBonus: monthRepurchaseBonus,
                    loyaltyQualified: loyaltyQualified,
                    loyaltyType: loyaltyType,
                    loyaltyBaseAmount: loyaltyBaseAmount,
                    loyaltyRetailProfit: loyaltyRetailProfit,
                    loyaltyBonus: monthLoyaltyBonus,
                    totalIncome: monthTotalIncome
                });
            }
            
            // Update Self BV field in Performance Calculator with LAST MONTH's Self BV only
            document.getElementById('perfPBV').value = lastMonthSelfBV;
            const pbv = lastMonthSelfBV;
            
            // Update the label to show the actual month being displayed
            const selfBVLabel = document.getElementById('selfBVMonthLabel');
            if (selfBVLabel) {
                if (highestMonthWithData > 0) {
                    selfBVLabel.textContent = `Self BV (Month ${highestMonthWithData})`;
                } else {
                    selfBVLabel.textContent = `Self BV (No data entered)`;
                }
            }
            
            // Get cumulative GBV from the table (this is already calculated as cumulative)
            const yourGBV = parseFloat(document.getElementById('perfYourGBV').value) || 0;

            // Get Group BV values (these should be cumulative values)
            const g1GBV = parseFloat(document.getElementById('perfG1GBV').value) || 0;
            const g2GBV = parseFloat(document.getElementById('perfG2GBV').value) || 0;
            const g3GBV = parseFloat(document.getElementById('perfG3GBV').value) || 0;
            const g4GBV = parseFloat(document.getElementById('perfG4GBV').value) || 0;
            const g5GBV = parseFloat(document.getElementById('perfG5GBV').value) || 0;

            // Calculate CUMULATIVE Total GBV for Performance Rate determination
            // This uses cumulative Self BV + cumulative Group BVs for consistent rate calculation
            const cumulativeTotalGBV = totalSelfBV + g1GBV + g2GBV + g3GBV + g4GBV + g5GBV;
            
            // Also calculate Total GBV with last month's Self BV (for reference if needed)
            const totalGBV = pbv + g1GBV + g2GBV + g3GBV + g4GBV + g5GBV;

            // Determine performance bonus rate based on CUMULATIVE Total GBV
            // This ensures Performance Rate properly reflects overall achievement level
            let perfBonusRate = 0;
            if (cumulativeTotalGBV >= 80001) perfBonusRate = 23;
            else if (cumulativeTotalGBV >= 40001) perfBonusRate = 19;
            else if (cumulativeTotalGBV >= 20001) perfBonusRate = 15;
            else if (cumulativeTotalGBV >= 5001) perfBonusRate = 11;
            else if (cumulativeTotalGBV >= 0) perfBonusRate = 5;

            // Calculate Retail Margin using dynamic rate from settings (cumulative from all months up to highest)
            const retailMargin = Math.round(totalSelfDP * retailMarginDecimal);
            
            // For backward compatibility, keep cumulativePerformanceBonusOnSelfBV for display reference
            const cumulativePerformanceBonusOnSelfBV = totalMonthlyPerformanceBonus;
            
            // ===============================================
            // LAST MONTH ONLY CALCULATION FOR DISPLAY
            // ===============================================
            
            // Get LAST MONTH's Group BVs directly from inputs
            const lastMonthG1 = highestMonthWithData > 0 ? (parseFloat(document.querySelector(`.leg1[data-month="${highestMonthWithData}"]`).value) || 0) : 0;
            const lastMonthG2 = highestMonthWithData > 0 ? (parseFloat(document.querySelector(`.leg2[data-month="${highestMonthWithData}"]`).value) || 0) : 0;
            const lastMonthG3 = highestMonthWithData > 0 ? (parseFloat(document.querySelector(`.leg3[data-month="${highestMonthWithData}"]`).value) || 0) : 0;
            const lastMonthG4 = highestMonthWithData > 0 ? (parseFloat(document.querySelector(`.leg4[data-month="${highestMonthWithData}"]`).value) || 0) : 0;
            const lastMonthG5 = highestMonthWithData > 0 ? (parseFloat(document.querySelector(`.leg5[data-month="${highestMonthWithData}"]`).value) || 0) : 0;
            
            // Calculate LAST MONTH's Monthly GBV (Self BV + all groups)
            const lastMonthMonthlyGBV = lastMonthSelfBV + lastMonthG1 + lastMonthG2 + lastMonthG3 + lastMonthG4 + lastMonthG5;
            
            // Calculate LAST MONTH's performance rate based on that month's GBV
            let lastMonthPerfRate = 0;
            if (lastMonthMonthlyGBV >= 80001) lastMonthPerfRate = 23;
            else if (lastMonthMonthlyGBV >= 40001) lastMonthPerfRate = 19;
            else if (lastMonthMonthlyGBV >= 20001) lastMonthPerfRate = 15;
            else if (lastMonthMonthlyGBV >= 5001) lastMonthPerfRate = 11;
            else if (lastMonthMonthlyGBV >= 0) lastMonthPerfRate = 5;
            
            // Calculate Performance Bonus from LAST MONTH's Self BV only
            const lastMonthPerformanceBonus = Math.round((lastMonthSelfBV * lastMonthPerfRate) / 100);
            const yourIncome = lastMonthPerformanceBonus;
            
            // Calculate differential income from each group FOR LAST MONTH ONLY
            const lastG1Rate = getRateFromGBV(lastMonthG1);
            const lastG2Rate = getRateFromGBV(lastMonthG2);
            const lastG3Rate = getRateFromGBV(lastMonthG3);
            const lastG4Rate = getRateFromGBV(lastMonthG4);
            const lastG5Rate = getRateFromGBV(lastMonthG5);
            
            // Income from groups = Group GBV √ó (Your Rate - Group Rate) FOR LAST MONTH
            const g1Income = Math.round((lastMonthG1 * (lastMonthPerfRate - lastG1Rate)) / 100);
            const g2Income = Math.round((lastMonthG2 * (lastMonthPerfRate - lastG2Rate)) / 100);
            const g3Income = Math.round((lastMonthG3 * (lastMonthPerfRate - lastG3Rate)) / 100);
            const g4Income = Math.round((lastMonthG4 * (lastMonthPerfRate - lastG4Rate)) / 100);
            const g5Income = Math.round((lastMonthG5 * (lastMonthPerfRate - lastG5Rate)) / 100);

            // Total Performance Bonus Income FOR LAST MONTH ONLY
            const totalPerfBonusIncome = yourIncome + g1Income + g2Income + g3Income + g4Income + g5Income;
            
            // Calculate LAST MONTH's Retail Margin
            const lastMonthRetailMargin = Math.round(highestMonthSelfDP * retailMarginDecimal);
            
            // Calculate LAST MONTH's total income from self purchase
            const lastMonthTotalSelfIncome = lastMonthRetailMargin + lastMonthPerformanceBonus;

            // Update display with LAST MONTH's values
            document.getElementById('perfYourIncome').textContent = `‚Çπ ${yourIncome.toLocaleString('en-IN')}`;
            document.getElementById('perfG1Income').textContent = `‚Çπ ${g1Income.toLocaleString('en-IN')}`;
            document.getElementById('perfG2Income').textContent = `‚Çπ ${g2Income.toLocaleString('en-IN')}`;
            document.getElementById('perfG3Income').textContent = `‚Çπ ${g3Income.toLocaleString('en-IN')}`;
            document.getElementById('perfG4Income').textContent = `‚Çπ ${g4Income.toLocaleString('en-IN')}`;
            document.getElementById('perfG5Income').textContent = `‚Çπ ${g5Income.toLocaleString('en-IN')}`;
            document.getElementById('perfTotalIncome').textContent = `‚Çπ ${totalPerfBonusIncome.toLocaleString('en-IN')}`;
            
            // For Income Breakdown section: use ACCURATE month-by-month calculation for CUMULATIVE
            const totalSelfIncome = retailMargin + totalMonthlyPerformanceBonus + totalRepurchaseBonus + totalLoyaltyBonus;
            
            // Calculate Total Group Income from Commission Difference for LAST MONTH
            const lastMonthTotalGroupIncome = g1Income + g2Income + g3Income + g4Income + g5Income;
            
            // Display comprehensive income breakdown - LAST MONTH + CUMULATIVE
            const breakdownHTML = `
                <!-- LAST MONTH CALCULATION SECTION -->
                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 25px; border-radius: 15px; border: 3px solid #1976d2; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h3 style="color: #0d47a1; margin-bottom: 20px; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üìä</span>
                        <span>Income Calculation Breakdown (Month ${highestMonthWithData} - Last Entered Month)</span>
                    </h3>
                    
                    <!-- Self Purchase Section (Month Only) -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #1565c0; margin-bottom: 15px;">
                        <h4 style="color: #1565c0; margin-bottom: 15px; font-size: 16px;">üì¶ Total Self Purchase (Month ${highestMonthWithData})</h4>
                        <div style="font-size: 14px; color: #0d47a1; line-height: 2;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                                <strong>Total Self DP:</strong>
                                <span style="color: #1565c0; font-weight: bold;">‚Çπ${highestMonthSelfDP.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                                <strong>Total Self BV (${dpToBvRate}%):</strong>
                                <span style="color: #1565c0; font-weight: bold;">${lastMonthSelfBV.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 2px solid #2196f3;">
                                <strong>Retail Margin (${retailMarginRate}%):</strong>
                                <span style="color: #1565c0; font-weight: bold;">‚Çπ${lastMonthRetailMargin.toLocaleString('en-IN')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Group BV Commission Difference Section (Below Self Purchase) -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #7b1fa2; margin-bottom: 15px;">
                        <h4 style="color: #7b1fa2; margin-bottom: 15px; font-size: 16px;">üë• Group BV Commission Difference (Month ${highestMonthWithData})</h4>
                        <div style="font-size: 13px; color: #4a148c; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e0e0e0; background: #f3e5f5; padding: 8px; border-radius: 5px; margin-bottom: 5px;">
                                <span><strong>Your Monthly GBV:</strong></span>
                                <span style="font-weight: bold; color: #7b1fa2;">${(lastMonthSelfBV + lastMonthG1 + lastMonthG2 + lastMonthG3 + lastMonthG4 + lastMonthG5).toLocaleString('en-IN')} | <strong>Your Rate: ${lastMonthPerfRate}%</strong></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e0e0e0;">
                                <span>G1: ‚Çπ${lastMonthG1.toLocaleString('en-IN')} √ó (${lastMonthPerfRate}% - ${lastG1Rate}%)</span>
                                <span style="font-weight: bold;">= ‚Çπ${g1Income.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e0e0e0;">
                                <span>G2: ‚Çπ${lastMonthG2.toLocaleString('en-IN')} √ó (${lastMonthPerfRate}% - ${lastG2Rate}%)</span>
                                <span style="font-weight: bold;">= ‚Çπ${g2Income.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e0e0e0;">
                                <span>G3: ‚Çπ${lastMonthG3.toLocaleString('en-IN')} √ó (${lastMonthPerfRate}% - ${lastG3Rate}%)</span>
                                <span style="font-weight: bold;">= ‚Çπ${g3Income.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e0e0e0;">
                                <span>G4: ‚Çπ${lastMonthG4.toLocaleString('en-IN')} √ó (${lastMonthPerfRate}% - ${lastG4Rate}%)</span>
                                <span style="font-weight: bold;">= ‚Çπ${g4Income.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 2px solid #9c27b0;">
                                <span>G5: ‚Çπ${lastMonthG5.toLocaleString('en-IN')} √ó (${lastMonthPerfRate}% - ${lastG5Rate}%)</span>
                                <span style="font-weight: bold;">= ‚Çπ${g5Income.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; margin-top: 5px; background: #e1bee7; padding: 10px; border-radius: 5px;">
                                <span><strong>Total Group Income:</strong></span>
                                <span style="font-weight: bold; color: #7b1fa2; font-size: 16px;">‚Çπ${lastMonthTotalGroupIncome.toLocaleString('en-IN')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Last Month Total Income Display -->
                    <div style="background: linear-gradient(135deg, #b3e5fc 0%, #4fc3f7 100%); padding: 20px; border-radius: 10px; text-align: center; border: 3px solid #0288d1;">
                        <div style="font-size: 16px; color: #01579b; margin-bottom: 8px; font-weight: bold;">
                            üéØ Total Income from Self Purchase (Month ${highestMonthWithData})
                        </div>
                        <div style="font-size: 32px; color: #01579b; font-weight: bold;">
                            ‚Çπ${lastMonthTotalSelfIncome.toLocaleString('en-IN')}
                        </div>
                        <div style="font-size: 12px; color: #0277bd; margin-top: 8px; line-height: 1.6;">
                            (Retail Margin ‚Çπ${lastMonthRetailMargin.toLocaleString('en-IN')} + Performance Bonus ‚Çπ${lastMonthPerformanceBonus.toLocaleString('en-IN')})
                        </div>
                    </div>
                </div>
                
                <!-- TOTAL PERFORMANCE BONUS (CUMULATIVE) SECTION -->
                <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 25px; border-radius: 15px; border: 3px solid #4caf50; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #1b5e20; margin-bottom: 20px; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üí∞</span>
                        <span>Total Performance Bonus (Cumulative - Months 1-${highestMonthWithData})</span>
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <!-- Left Column: Cumulative Self Purchase -->
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #2e7d32;">
                            <h4 style="color: #2e7d32; margin-bottom: 15px; font-size: 16px;">üì¶ Total Self Purchase (Cumulative)</h4>
                            <div style="font-size: 14px; color: #1b5e20; line-height: 2;">
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                                    <strong>Total Self DP:</strong>
                                    <span style="color: #2e7d32; font-weight: bold;">‚Çπ${totalSelfDP.toLocaleString('en-IN')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                                    <strong>Total Self BV (${dpToBvRate}%):</strong>
                                    <span style="color: #2e7d32; font-weight: bold;">${totalSelfBV.toLocaleString('en-IN')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 2px solid #4caf50;">
                                    <strong>Retail Margin (${retailMarginRate}%):</strong>
                                    <span style="color: #2e7d32; font-weight: bold;">‚Çπ${retailMargin.toLocaleString('en-IN')}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: Cumulative Performance Bonus -->
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #1976d2;">
                            <h4 style="color: #1976d2; margin-bottom: 15px; font-size: 16px;">üìä Performance Bonus (Cumulative)</h4>
                            <div style="font-size: 14px; color: #0d47a1; line-height: 2;">
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                                    <strong>Total GBV (Cumulative):</strong>
                                    <span style="color: #1976d2; font-weight: bold;">${cumulativeTotalGBV.toLocaleString('en-IN')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                                    <strong>Final Performance Rate:</strong>
                                    <span style="color: #1976d2; font-weight: bold;">${perfBonusRate}%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 2px solid #2196f3;">
                                    <strong>Total Performance Bonus:</strong>
                                    <span style="color: #1976d2; font-weight: bold;">‚Çπ${cumulativePerformanceBonusOnSelfBV.toLocaleString('en-IN')}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cumulative Total Income Display -->
                    <div style="background: linear-gradient(135deg, #fff59d 0%, #fdd835 100%); padding: 20px; border-radius: 10px; text-align: center; border: 3px solid #f9a825;">
                        <div style="font-size: 16px; color: #e65100; margin-bottom: 8px; font-weight: bold;">
                            üéØ Total Income from Self Purchase (Cumulative - Months 1-${highestMonthWithData})
                        </div>
                        <div style="font-size: 32px; color: #e65100; font-weight: bold;">
                            ‚Çπ${totalSelfIncome.toLocaleString('en-IN')}
                        </div>
                        <div style="font-size: 12px; color: #bf360c; margin-top: 8px; line-height: 1.6;">
                            (Retail Margin ‚Çπ${retailMargin.toLocaleString('en-IN')} + Performance Bonus ‚Çπ${totalMonthlyPerformanceBonus.toLocaleString('en-IN')}${totalRepurchaseBonus > 0 ? ' + Repurchase Bonus ‚Çπ' + totalRepurchaseBonus.toLocaleString('en-IN') : ''}${totalLoyaltyBonus > 0 ? ' + Loyalty Bonus ‚Çπ' + totalLoyaltyBonus.toLocaleString('en-IN') : ''})
                        </div>
                    </div>
                </div>
                        </div>
                    </div>
                    
                    <!-- Formula Explanation -->
                    <div style="margin-top: 20px; padding: 15px; background: #fff8e1; border-radius: 8px; border-left: 4px solid #ffa726;">
                        <strong style="color: #e65100;">üí° ‡§∏‡§Æ‡§ù‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è Formula (Month-by-Month Breakdown):</strong>
                        
                        <div style="background: #ffebee; padding: 12px; border-radius: 6px; margin: 10px 0; border: 2px solid #e53935;">
                            <strong style="color: #c62828;">‚ö†Ô∏è ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡•ã‡§ü:</strong><br>
                            <ul style="margin: 8px 0; padding-left: 20px; color: #b71c1c; font-size: 12px; line-height: 1.6;">
                                <li><strong>Performance Bonus Rate</strong> ‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á <strong>‡§â‡§∏‡•Ä ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á GBV</strong> ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§π‡•à (cumulative ‡§®‡§π‡•Ä‡§Ç)</li>
                                <li><strong>Loyalty & Super Loyalty Bonuses</strong> ‡§ï‡•á‡§µ‡§≤ milestone achieve ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§Æ‡§π‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§π‡•Ä ‡§Æ‡§ø‡§≤‡§§‡•á ‡§π‡•à‡§Ç (‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§®‡§π‡•Ä‡§Ç)</li>
                            </ul>
                        </div>
                        
                        <div style="margin-top: 15px; color: #bf360c; font-size: 13px; line-height: 1.8;">
                            <strong>Total Self DP (Cumulative, Months 1-${highestMonthWithData})</strong> = ${totalSelfDP.toLocaleString('en-IN')}<br>
                            <strong>Total Self BV (Cumulative)</strong> = Total Self DP √ó ${dpToBvRate}% = ${totalSelfBV.toLocaleString('en-IN')}<br>
                            <strong>Retail Margin (Cumulative)</strong> = Total Self DP √ó ${retailMarginRate}% = ‚Çπ${retailMargin.toLocaleString('en-IN')}<br><br>
                            
                            <div style="background: #ffe0b2; padding: 12px; border-radius: 6px; margin: 10px 0;">
                                <strong style="color: #e65100;">üìä ‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡§æ Complete Income Breakdown:</strong><br>
                                <small>(‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•Ä ‡§∏‡§≠‡•Ä income components ‡§ï‡•á ‡§∏‡§æ‡§• Total Income)</small>
                            </div>
                            
                            ${monthlyBreakdown.map(m => `
                                <div style="background: white; padding: 12px; margin: 8px 0; border-left: 4px solid #1976d2; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="background: #e3f2fd; padding: 8px; margin-bottom: 8px; border-radius: 4px;">
                                        <strong style="color: #1565c0;">üìÖ Month ${m.month}</strong> | Self DP = ${m.selfDP.toLocaleString('en-IN')}, Self BV = ${m.selfBV.toLocaleString('en-IN')}, <strong style="color: #d32f2f;">Month GBV = ${m.monthlyGBV.toLocaleString('en-IN')}</strong>
                                    </div>
                                    
                                    <div style="font-size: 13px; line-height: 1.8; color: #424242;">
                                        <strong style="color: #4caf50;">üí∞ Retail Margin:</strong> ${m.selfDP.toLocaleString('en-IN')} √ó ${retailMarginRate}% = ‚Çπ${m.retailMargin.toLocaleString('en-IN')}<br>
                                        <strong style="color: #ff9800;">‚≠ê Performance Bonus:</strong> ${m.selfBV.toLocaleString('en-IN')} √ó ${m.perfRate}% (based on Month GBV ${m.monthlyGBV.toLocaleString('en-IN')}) = ‚Çπ${m.performanceBonus.toLocaleString('en-IN')}<br>
                                        ${m.repurchaseQualified ? `<strong style="color: #2e7d32;">üéÅ Repurchase Bonus:</strong> 8,450 + Retail Profit (${m.repurchaseRetailProfit.toLocaleString('en-IN')}) = ‚Çπ${m.repurchaseBonus.toLocaleString('en-IN')} <span style="background: #c8e6c9; padding: 2px 6px; border-radius: 3px; font-size: 11px;">‚úì Qualified</span><br>` : ''}
                                        ${m.loyaltyQualified ? `<strong style="color: ${m.loyaltyType === 'super_loyalty_12' ? '#6a1b9a' : m.loyaltyType === 'super_loyalty_5' ? '#7b1fa2' : m.loyaltyType === 'loyalty_12' ? '#8e24aa' : m.loyaltyType === 'loyalty_6' ? '#9c27b0' : '#1976d2'};">${m.loyaltyType === 'super_loyalty_12' ? 'üíéüíé Super Loyalty 12-Month Bonus' : m.loyaltyType === 'super_loyalty_5' ? 'üíé Super Loyalty 5-Month Bonus' : m.loyaltyType === 'loyalty_12' ? 'üèÜüíé Loyalty 12-Month Bonus (Double)' : m.loyaltyType === 'loyalty_6' ? 'üèÜ Loyalty 6-Month Bonus' : 'üèÜ Loyalty Bonus'}:</strong> ${m.loyaltyBaseAmount.toLocaleString('en-IN')} + Retail Profit 30% (${m.loyaltyRetailProfit.toLocaleString('en-IN')}) = ‚Çπ${m.loyaltyBonus.toLocaleString('en-IN')} <span style="background: ${m.loyaltyType === 'super_loyalty_12' ? '#e1bee7' : m.loyaltyType === 'super_loyalty_5' ? '#e1bee7' : m.loyaltyType === 'loyalty_12' ? '#e1bee7' : m.loyaltyType === 'loyalty_6' ? '#f3e5f5' : '#bbdefb'}; padding: 2px 6px; border-radius: 3px; font-size: 11px;">‚úì Awarded</span><br>` : ''}
                                    </div>
                                    
                                    <div style="background: #fff3e0; padding: 8px; margin-top: 8px; border-radius: 4px; border: 2px solid #ff9800;">
                                        <strong style="color: #e65100;">üìä Month ${m.month} Total Income = ‚Çπ${m.totalIncome.toLocaleString('en-IN')}</strong>
                                    </div>
                                </div>
                            `).join('')}
                            
                            <div style="background: #c8e6c9; padding: 12px; border-radius: 6px; margin: 15px 0; border: 2px solid #4caf50;">
                                <strong>‚≠ê Total Performance Bonus (‡§∏‡§≠‡•Ä ${highestMonthWithData} ‡§Æ‡§π‡•Ä‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§ú‡•ã‡§°‡§º)</strong> = ${monthlyBreakdown.map(m => '‚Çπ' + m.performanceBonus.toLocaleString('en-IN')).join(' + ')} = <strong>‚Çπ${totalMonthlyPerformanceBonus.toLocaleString('en-IN')}</strong>
                            </div>
                            
                            ${totalRepurchaseBonus > 0 ? `
                            <div style="background: #c8e6c9; padding: 12px; border-radius: 6px; margin: 15px 0; border: 2px solid #2e7d32;">
                                <strong>üéÅ Total Repurchase Bonus (‡§ú‡•ã ‡§Æ‡§π‡•Ä‡§®‡•á qualify ‡§ï‡§ø‡§Ø‡•á)</strong> = ${monthlyBreakdown.filter(m => m.repurchaseQualified).map(m => '‚Çπ' + m.repurchaseBonus.toLocaleString('en-IN')).join(' + ')} = <strong style="color: #2e7d32;">‚Çπ${totalRepurchaseBonus.toLocaleString('en-IN')}</strong>
                            </div>
                            ` : ''}
                            
                            ${totalLoyaltyBonus > 0 ? `
                            <div style="background: #e1bee7; padding: 12px; border-radius: 6px; margin: 15px 0; border: 2px solid #7b1fa2;">
                                <strong>üíé Total Loyalty/Super Loyalty Bonuses</strong><br>
                                <div style="font-size: 12px; margin-top: 8px; line-height: 1.6;">
                                    ${monthlyBreakdown.filter(m => m.loyaltyQualified).map(m => {
                                        let label = '';
                                        if (m.loyaltyType === 'super_loyalty_12') label = `Month ${m.month}: ‚Çπ${m.loyaltyBonus.toLocaleString('en-IN')} (SL-12)`;
                                        else if (m.loyaltyType === 'super_loyalty_5') label = `Month ${m.month}: ‚Çπ${m.loyaltyBonus.toLocaleString('en-IN')} (SL-5)`;
                                        else if (m.loyaltyType === 'loyalty_12') label = `Month ${m.month}: ‚Çπ${m.loyaltyBonus.toLocaleString('en-IN')} (L-12)`;
                                        else if (m.loyaltyType === 'loyalty_6') label = `Month ${m.month}: ‚Çπ${m.loyaltyBonus.toLocaleString('en-IN')} (L-6)`;
                                        else label = `Month ${m.month}: ‚Çπ${m.loyaltyBonus.toLocaleString('en-IN')} (L)`;
                                        return label;
                                    }).join(' + ')}
                                    <br><strong style="color: #7b1fa2;">Total = ‚Çπ${totalLoyaltyBonus.toLocaleString('en-IN')}</strong>
                                </div>
                                <div style="font-size: 11px; margin-top: 8px; color: #6a1b9a;">
                                    L-6 = Loyalty 6-Month (30% margin) | L-12 = Loyalty 12-Month Double (30% margin) | SL-5 = Super Loyalty 5-Month | SL-12 = Super Loyalty 12-Month
                                </div>
                            </div>
                            ` : ''}
                            
                            <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 18px; border-radius: 8px; margin: 20px 0; border: 3px solid #f57c00; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                                <strong style="font-size: 16px; color: #e65100;">üìä Total Income from Self Purchase ‡§ï‡§æ Complete Calculation:</strong><br><br>
                                <div style="font-size: 14px; line-height: 2.2; color: #bf360c;">
                                    <strong>1Ô∏è‚É£ Retail Margin (Cumulative)</strong> = ‚Çπ${retailMargin.toLocaleString('en-IN')}<br>
                                    <strong>2Ô∏è‚É£ Performance Bonus (Month-by-Month Total)</strong> = ‚Çπ${totalMonthlyPerformanceBonus.toLocaleString('en-IN')}<br>
                                    ${totalRepurchaseBonus > 0 ? `<strong>3Ô∏è‚É£ Repurchase Bonus (Qualifying Months)</strong> = ‚Çπ${totalRepurchaseBonus.toLocaleString('en-IN')}<br>` : ''}
                                    ${totalLoyaltyBonus > 0 ? `<strong>4Ô∏è‚É£ Loyalty/Super Loyalty Bonus (Qualifying Months)</strong> = ‚Çπ${totalLoyaltyBonus.toLocaleString('en-IN')}<br>` : ''}
                                    <hr style="border: 2px solid #f57c00; margin: 12px 0;">
                                    <div style="background: #fff; padding: 10px; border-radius: 6px; border: 2px solid #ff6f00;">
                                        <strong style="font-size: 17px; color: #e65100;">üí∞ GRAND TOTAL INCOME</strong><br>
                                        <span style="font-size: 14px;">= ${retailMargin.toLocaleString('en-IN')} + ${totalMonthlyPerformanceBonus.toLocaleString('en-IN')}${totalRepurchaseBonus > 0 ? ' + ' + totalRepurchaseBonus.toLocaleString('en-IN') : ''}${totalLoyaltyBonus > 0 ? ' + ' + totalLoyaltyBonus.toLocaleString('en-IN') : ''}</span><br>
                                        <strong style="font-size: 20px; color: #1b5e20;">= ‚Çπ${totalSelfIncome.toLocaleString('en-IN')}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Update the breakdown display
            document.getElementById('incomeCalculationBreakdown').innerHTML = breakdownHTML;
        }

        // Rank Determination - As per PDF Business Plan
        // Director: 23% Level (80,001+ TGBV) & maintain 25000 GBV in closing month (Page 7)
        // Bronze Director: 25,000 GBV from 1 Director leg + 20,000 GBV PGBV (Page 9)
        // Silver Director: 25,000 GBV from each of 2 Director legs + 15,000 PGBV (Page 11)
        // Gold Director: 25,000 GBV from each of 3 Director legs + 10,000 PGBV (Page 13)
        // Ruby Director: 25,000 GBV from each of 4 Director legs + 2,500 PGBV (Page 15)
        // Diamond: 1,00,000 GBV from each of 4 Director legs for 3 consecutive months + PBV 1000 (Page 16)
        // Note: Simplified thresholds for calculator purposes
        function determineRank(cumulativeGbv) {
            // Crown President: 8,00,000 GBV from each of 4 Crown Diamond legs (Page 22)
            if (cumulativeGbv >= 32000000) return 'Crown President';
            // Crown Ambassador: 8,00,000 GBV from each of 2 Crown Diamond legs + 2,00,000 GBV from 2 Diamond legs (Page 21)
            if (cumulativeGbv >= 20000000) return 'Crown Ambassador';
            // Crown Diamond: 2,00,000 GBV from each of 4 Diamond legs (Page 20)
            if (cumulativeGbv >= 8000000) return 'Crown Diamond';
            // Black Diamond: 2,00,000 GBV from each of 3 Diamond legs + 50,000 from 1 Director leg (Page 19)
            if (cumulativeGbv >= 6500000) return 'Black Diamond';
            // Blue Diamond: 2,00,000 GBV from each of 2 Diamond legs + 50,000 from 2 Director legs (Page 18)
            if (cumulativeGbv >= 5000000) return 'Blue Diamond';
            // Double Diamond: 2,00,000 GBV from 1 Diamond leg + 50,000 from 3 Director legs (Page 17)
            if (cumulativeGbv >= 3500000) return 'Double Diamond';
            // Diamond Director: 1,00,000 GBV from each of 4 Director legs for 3 months + PBV 1000 (Page 16)
            if (cumulativeGbv >= 400000) return 'Diamond Director';
            // Ruby Director: 25,000 GBV from each of 4 Director legs + 2,500 PGBV (Page 15)
            if (cumulativeGbv >= 102500) return 'Ruby Director';
            // Gold Director: 25,000 GBV from each of 3 Director legs + 10,000 PGBV (Page 13)
            if (cumulativeGbv >= 85000) return 'Gold Director';
            // Silver Director: 25,000 GBV from each of 2 Director legs + 15,000 PGBV (Page 11)
            if (cumulativeGbv >= 65000) return 'Silver Director';
            // Bronze Director: 25,000 GBV from 1 Director leg + 20,000 PGBV (Page 9)
            if (cumulativeGbv >= 45000) return 'Bronze Director';
            // Director: 23% Level & maintain 25000 GBV (Page 7)
            if (cumulativeGbv >= 25000) return 'Director';
            return 'Distributor';
        }

        function calculateMonthlyIncome(selfDp, dpBV, monthlyGbv, cumulativeGbv, rank, month) {
            // Get dynamic DP to BV conversion rate from Calculator Settings
            const dpToBvRate = parseFloat(document.getElementById('dpToBvRate').value) || 30;
            const dpToBvDecimal = dpToBvRate / 100; // Convert percentage to decimal
            
            let income = 0;

            // Income 1: Retail Profit uses dynamic conversion rate
            income += selfDp * dpToBvDecimal;

            // Income 2: Performance Bonus
            const perfRate = getPerformanceRate(cumulativeGbv);
            income += monthlyGbv * perfRate;

            // Note: Loyalty Bonus and Super Loyalty Bonus are PRODUCT benefits (free products),
            // not cash income. They are awarded after 5 consecutive months and displayed separately.

            // Income 7: Director Fund
            if (rank.includes('Director') || rank.includes('Diamond') || rank.includes('Crown')) {
                const directorRate = parseFloat(document.getElementById('directorFundRate').value) / 100;
                income += monthlyGbv * directorRate;
            }

            // Income 11: Annual Royalty (only on month 12)
            if (month === 12 && (rank.includes('Diamond') || rank.includes('Crown'))) {
                const royaltyRate = parseFloat(document.getElementById('royaltyRate').value) / 100;
                income += cumulativeGbv * royaltyRate;
            }

            return income;
        }

        function getPerformanceRate(cumulativeGbv) {
            if (cumulativeGbv >= 80001) return 0.23;
            if (cumulativeGbv >= 40001) return 0.19;
            if (cumulativeGbv >= 20001) return 0.15;
            if (cumulativeGbv >= 5001) return 0.11;
            return 0.05;
        }

        function updateSummary(cumulative, totalIncome, month12Data) {
            // Calculate CTO-based bonuses
            try {
                const ctoBonuses = calculateAllCTOBonuses(cumulative);
                console.log('CTO Bonuses Calculated:', ctoBonuses);
                
                const totalCTOBonus = (ctoBonuses.tbb?.bonus || 0) + (ctoBonuses.bbb?.bonus || 0) + (ctoBonuses.lb?.bonus || 0);
                const grandTotal = totalIncome + totalCTOBonus;
                
                const html = `
                    <h2>üìä 12-Month Business Summary</h2>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <div class="label">Total Self BV</div>
                            <div class="value">${Math.round(cumulative.dpBV).toLocaleString('en-IN')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Total Group BV</div>
                            <div class="value">‚Çπ ${Math.round(cumulative.leg1 + cumulative.leg2 + cumulative.leg3 + cumulative.leg4 + cumulative.leg5).toLocaleString('en-IN')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Cumulative GBV</div>
                            <div class="value">‚Çπ ${Math.round(cumulative.total).toLocaleString('en-IN')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Final Rank</div>
                            <div class="value">${month12Data ? month12Data.rank : '-'}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Monthly Income (12 Months)</div>
                            <div class="value">‚Çπ ${Math.round(totalIncome).toLocaleString('en-IN')}</div>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; margin-top: 20px; color: white;">
                        <h3 style="margin: 0 0 15px 0; font-size: 18px; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px;">
                            üí∞ Company Turnover Based Bonuses
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">ü§ù Team Building (${ctoBonuses.tbb?.percent || 0}%)</div>
                                <div style="font-size: 20px; font-weight: bold;">‚Çπ${(ctoBonuses.tbb?.bonus || 0).toLocaleString('en-IN')}</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">${ctoBonuses.tbb?.type || 'Not Qualified'} - ${ctoBonuses.tbb?.qualifyingLegs || 0} legs</div>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">üöÄ Business Building (${ctoBonuses.bbb?.percent || 0}%)</div>
                                <div style="font-size: 20px; font-weight: bold;">‚Çπ${(ctoBonuses.bbb?.bonus || 0).toLocaleString('en-IN')}</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">${ctoBonuses.bbb?.type || 'Not Qualified'} - ${ctoBonuses.bbb?.qualifyingLegs || 0} legs</div>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">üëë Leadership (${ctoBonuses.lb?.yourPercent || 0}%)</div>
                                <div style="font-size: 20px; font-weight: bold;">‚Çπ${(ctoBonuses.lb?.bonus || 0).toLocaleString('en-IN')}</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 3px;">${ctoBonuses.rank || 'No Rank'} - Total ${ctoBonuses.lb?.totalPercent || 0}%</div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">Total CTO Bonuses</div>
                            <div style="font-size: 28px; font-weight: bold;">‚Çπ${totalCTOBonus.toLocaleString('en-IN')}</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                            <div style="font-size: 16px; margin-bottom: 5px;">üéØ GRAND TOTAL (Monthly + CTO Bonuses)</div>
                            <div style="font-size: 32px; font-weight: bold;">‚Çπ${grandTotal.toLocaleString('en-IN')}</div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 6px; margin-top: 15px; font-size: 11px; text-align: center;">
                            üí° Debug: Legs = [${cumulative.leg1.toFixed(0)}, ${cumulative.leg2.toFixed(0)}, ${cumulative.leg3.toFixed(0)}, ${cumulative.leg4.toFixed(0)}, ${cumulative.leg5.toFixed(0)}] | Total GBV = ${cumulative.total.toFixed(0)} | Rank = ${ctoBonuses.rank}
                        </div>
                    </div>
                `;
                document.getElementById('summaryCard').innerHTML = html;
            } catch (error) {
                console.error('Error calculating CTO bonuses:', error);
                // Fallback to simple display without CTO bonuses
                const html = `
                    <h2>üìä 12-Month Business Summary</h2>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <div class="label">Total Self BV</div>
                            <div class="value">${Math.round(cumulative.dpBV).toLocaleString('en-IN')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Total Group BV</div>
                            <div class="value">‚Çπ ${Math.round(cumulative.leg1 + cumulative.leg2 + cumulative.leg3 + cumulative.leg4 + cumulative.leg5).toLocaleString('en-IN')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Cumulative GBV</div>
                            <div class="value">‚Çπ ${Math.round(cumulative.total).toLocaleString('en-IN')}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Final Rank</div>
                            <div class="value">${month12Data ? month12Data.rank : '-'}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Total Income (12 Months)</div>
                            <div class="value">‚Çπ ${Math.round(totalIncome).toLocaleString('en-IN')}</div>
                        </div>
                    </div>
                    <div style="background: #ffebee; padding: 15px; border-radius: 8px; margin-top: 15px; color: #c62828;">
                        <strong>‚ö†Ô∏è Error calculating bonuses:</strong> ${error.message}
                    </div>
                `;
                document.getElementById('summaryCard').innerHTML = html;
            }
        }

        function updateIncomeBreakdown(allMonthsData, cumulative) {
            if (!allMonthsData || allMonthsData.length === 0) {
                document.getElementById('incomeBreakdown').innerHTML = '<p style="text-align: center; color: #666; padding: 40px; font-size: 16px;">üìä Enter data in any month to see detailed income breakdown</p>';
                return;
            }

            // Get dynamic rates from Calculator Settings
            const dpToBvRate = parseFloat(document.getElementById('dpToBvRate').value) || 30;
            const dpToBvDecimal = dpToBvRate / 100; // Convert percentage to decimal
            const retailMarginRate = parseFloat(document.getElementById('retailMargin').value) || 30;
            const retailMarginDecimal = retailMarginRate / 100; // Convert percentage to decimal
            const directorRate = parseFloat(document.getElementById('directorFundRate').value) / 100;
            const royaltyRate = parseFloat(document.getElementById('royaltyRate').value) / 100;

            // Helper function to check if an amount is a valid multiple of 1500
            // CRITICAL RULE: Loyalty Bonus is ONLY for amounts that are multiples of 1500 BUT STRICTLY LESS than 48000
            // Any amount >= 48000 belongs exclusively to Super Loyalty Bonus category
            function isValidLoyaltyAmount(amount) {
                return amount >= 1500 && amount < 48000 && amount % 1500 === 0;
            }

            // Pre-scan all months to determine where bonuses are awarded
            // CRITICAL UNDERSTANDING OF BONUS STRUCTURE:
            // 1. Super Loyalty 5-month: Awards ‚Çπ48,000 in 6th month after 5 consecutive months of ‚Çπ48,000+
            //    This bonus resets after awarding and can be earned again
            // 2. Super Loyalty 12-month: Awards ‚Çπ96,000 in 12th month if ALL 12 months have ‚Çπ48,000+
            //    This is called "Super Loyalty Double" and is ADDITIONAL to 5-month bonus
            // 3. If user maintains ‚Çπ48,000+ for all 12 months:
            //    Month 6: Gets ‚Çπ48,000 (5-month bonus)
            //    Month 12: Gets ‚Çπ96,000 (12-month bonus)
            //    TOTAL: ‚Çπ144,000 free products in the year
            // 4. Loyalty Bonus: Only for amounts < ‚Çπ48,000, cannot coexist with Super Loyalty in same window
            
            const loyaltyAwardedMonths = [];
            const loyaltyQualifiedButSuperseded = [];
            const superLoyalty5AwardedMonths = [];
            const superLoyalty12AwardedMonths = [];

            // STEP 1: Scan for Super Loyalty 12-month bonus FIRST
            // This checks if ALL 12 months have ‚Çπ48,000+ and awards ‚Çπ96,000 in Month 12
            if (allMonthsData.length === 12) {
                let all48k = true;
                for (let i = 0; i < 12; i++) {
                    if (allMonthsData[i].selfDp < 48000) {
                        all48k = false;
                        break;
                    }
                }
                if (all48k) {
                    superLoyalty12AwardedMonths.push({ month: 11, amount: 96000 });
                }
            }

            // STEP 2: Scan for Super Loyalty 5-month bonuses
            // These award independently and reset after each award
            // IMPORTANT: If 12-month bonus is awarded in a specific month, 
            // do NOT award 5-month bonus in that same month
            let lastSuper5Award = -1;
            for (let i = 0; i < allMonthsData.length; i++) {
                if (i < 5) continue; // Need at least 5 previous months
                
                // Check if 12-month bonus is being awarded in this month
                const has12MonthInThisMonth = superLoyalty12AwardedMonths.some(award => award.month === i);
                
                // Skip this month if 12-month bonus is here (12-month takes precedence in display)
                if (has12MonthInThisMonth) continue;
                
                let consecutive48k = true;
                let canAward = true;
                
                // Check if previous 5 months (after last award) all have 48000+
                for (let j = i - 5; j < i; j++) {
                    if (j <= lastSuper5Award) {
                        canAward = false;
                        break;
                    }
                    
                    if (allMonthsData[j].selfDp < 48000) {
                        consecutive48k = false;
                        break;
                    }
                }
                
                if (canAward && consecutive48k) {
                    superLoyalty5AwardedMonths.push({ month: i, amount: 48000 });
                    lastSuper5Award = i; // Reset counter after awarding
                }
            }

            // STEP 3: Scan for Loyalty Bonus awards
            // ONLY for amounts strictly < 48000
            // AND only in months/windows where no Super Loyalty bonus was awarded
            let lastLoyaltyAward = -1;
            for (let i = 0; i < allMonthsData.length; i++) {
                if (i < 5) continue; // Need at least 5 previous months
                
                // Check if Super Loyalty was awarded in this month
                const superAwardedHere = superLoyalty5AwardedMonths.some(award => award.month === i) ||
                                         superLoyalty12AwardedMonths.some(award => award.month === i);
                
                let consecutiveQualifying = 0;
                let minAmount = Infinity;
                let canAward = true;
                let hasLargeAmount = false; // Track if any month has amount >= 48000
                
                // Check previous 5 months (after last award)
                for (let j = i - 5; j < i; j++) {
                    if (j <= lastLoyaltyAward) {
                        canAward = false;
                        break;
                    }
                    
                    const monthAmount = allMonthsData[j].selfDp;
                    
                    // CRITICAL: If ANY of the 5 months has amount >= 48000,
                    // this entire window is disqualified from Loyalty Bonus
                    if (monthAmount >= 48000) {
                        hasLargeAmount = true;
                        canAward = false;
                        break;
                    }
                    
                    if (isValidLoyaltyAmount(monthAmount)) {
                        consecutiveQualifying++;
                        minAmount = Math.min(minAmount, monthAmount);
                    } else {
                        canAward = false;
                        break;
                    }
                }
                
                // Award only if: 5 qualifying months, no large amounts, and no Super Loyalty in this month
                if (canAward && consecutiveQualifying === 5 && !hasLargeAmount) {
                    if (superAwardedHere) {
                        // Track that loyalty was qualified but superseded by Super Loyalty
                        loyaltyQualifiedButSuperseded.push({ month: i, amount: minAmount });
                    } else {
                        loyaltyAwardedMonths.push({ month: i, amount: minAmount });
                        lastLoyaltyAward = i; // Reset counter after awarding
                    }
                }
            }

            // Helper function to calculate bonuses for a specific month
            function calculateBonuses(currentMonthIndex, allData) {
                const bonuses = {
                    repurchaseBonus: 0,
                    loyaltyBonus: 0,
                    loyaltyProgress: 0,
                    loyaltyQualifying: false,
                    loyaltySuperseded: false,
                    superLoyalty5Month: 0,
                    superLoyalty12Month: 0,
                    superLoyaltyProgress: 0
                };

                const currentSelfDP = allData[currentMonthIndex].selfDp;

                // Calculate Repurchase Bonus (Income 3)
                // IMPORTANT: Repurchase Bonus income = Base amount + Retail Margin on that amount
                // Example: 8450 (base) + (8450 √ó 30% retail margin) = 8450 + 2535 = 10,985
                if (currentSelfDP >= 48000) {
                    const repurchaseBaseAmount = 8450;
                    const repurchaseRetailMargin = repurchaseBaseAmount * retailMarginDecimal;
                    bonuses.repurchaseBonus = repurchaseBaseAmount + repurchaseRetailMargin;
                    // Store individual components for display purposes
                    bonuses.repurchaseBaseAmount = repurchaseBaseAmount;
                    bonuses.repurchaseRetailMargin = repurchaseRetailMargin;
                }

                // Check if Super Loyalty was awarded this month
                // IMPORTANT: Super Loyalty income = Base amount + Retail Profit on that amount
                // Just like Repurchase Bonus and Loyalty Bonus, this represents the full economic value
                const super5Award = superLoyalty5AwardedMonths.find(award => award.month === currentMonthIndex);
                if (super5Award) {
                    const super5BaseAmount = super5Award.amount; // 48000
                    const super5RetailProfit = super5BaseAmount * retailMarginDecimal;
                    bonuses.superLoyalty5Month = super5BaseAmount + super5RetailProfit;
                    bonuses.superLoyalty5BaseAmount = super5BaseAmount;
                    bonuses.superLoyalty5RetailProfit = super5RetailProfit;
                }

                const super12Award = superLoyalty12AwardedMonths.find(award => award.month === currentMonthIndex);
                if (super12Award) {
                    const super12BaseAmount = super12Award.amount; // 96000
                    const super12RetailProfit = super12BaseAmount * retailMarginDecimal;
                    bonuses.superLoyalty12Month = super12BaseAmount + super12RetailProfit;
                    bonuses.superLoyalty12BaseAmount = super12BaseAmount;
                    bonuses.superLoyalty12RetailProfit = super12RetailProfit;
                }

                // CRITICAL BUSINESS RULE: Loyalty and Super Loyalty are mutually exclusive
                // If both qualify in the same month, ONLY Super Loyalty is awarded (higher tier)
                const superLoyaltyAwarded = (super5Award || super12Award) ? true : false;

                // Check if Loyalty was awarded (only if Super Loyalty wasn't)
                const loyaltyAward = loyaltyAwardedMonths.find(award => award.month === currentMonthIndex);
                if (loyaltyAward && !superLoyaltyAwarded) {
                    // Award Loyalty Bonus only when Super Loyalty is NOT being awarded
                    bonuses.loyaltyBonus = loyaltyAward.amount;
                    bonuses.loyaltyQualifying = true;
                }

                // Check if loyalty qualified but was superseded by Super Loyalty
                const loyaltySuperseded = loyaltyQualifiedButSuperseded.find(item => item.month === currentMonthIndex);
                if (loyaltySuperseded) {
                    bonuses.loyaltySuperseded = true;
                    bonuses.loyaltySupersededAmount = loyaltySuperseded.amount;
                }

                // Calculate Loyalty Progress
                let startCountingFrom = 0;
                // Start from after last actual loyalty award OR last super loyalty award (whichever is more recent)
                for (let award of loyaltyAwardedMonths) {
                    if (award.month < currentMonthIndex) {
                        startCountingFrom = Math.max(startCountingFrom, award.month + 1);
                    }
                }
                for (let award of superLoyalty5AwardedMonths) {
                    if (award.month < currentMonthIndex) {
                        startCountingFrom = Math.max(startCountingFrom, award.month + 1);
                    }
                }
                
                let progressCount = 0;
                for (let i = startCountingFrom; i <= currentMonthIndex; i++) {
                    if (i >= allData.length) break;
                    if (isValidLoyaltyAmount(allData[i].selfDp)) {
                        progressCount++;
                    } else {
                        progressCount = 0;
                    }
                }
                bonuses.loyaltyProgress = Math.min(progressCount, 5);

                // Calculate Super Loyalty Progress
                let startSuper48kFrom = 0;
                for (let award of superLoyalty5AwardedMonths) {
                    if (award.month < currentMonthIndex) {
                        startSuper48kFrom = Math.max(startSuper48kFrom, award.month + 1);
                    }
                }
                
                let super48kCount = 0;
                for (let i = startSuper48kFrom; i <= currentMonthIndex; i++) {
                    if (i >= allData.length) break;
                    if (allData[i].selfDp >= 48000) {
                        super48kCount++;
                    } else {
                        super48kCount = 0;
                    }
                }
                bonuses.superLoyaltyProgress = super48kCount;

                return bonuses;
            }

            let fullHTML = '';

            // Loop through all months that have data and create breakdown for each
            allMonthsData.forEach((monthData, index) => {
                const { month, selfDp, dpBV, monthlyGbv, cumulativeGbv, rank } = monthData;

                // Calculate bonuses for this month
                const monthBonuses = calculateBonuses(index, allMonthsData);

                // Calculate total Super Loyalty Bonus
                const totalSuperLoyalty = monthBonuses.superLoyalty5Month + monthBonuses.superLoyalty12Month;

                // Calculate all income types for this specific month
                const incomes = {
                    retailProfit: selfDp * retailMarginDecimal,
                    performanceBonus: monthlyGbv * getPerformanceRate(cumulativeGbv),
                    repurchaseBonus: monthBonuses.repurchaseBonus,
                    loyaltyBonus: monthBonuses.loyaltyBonus,
                    superLoyaltyBonus: totalSuperLoyalty,
                    teamBuildingBonus: 0,
                    directorFund: (rank.includes('Director') || rank.includes('Diamond') || rank.includes('Crown')) ? monthlyGbv * directorRate : 0,
                    businessBuilding: 0,
                    leadershipBonus: 0,
                    otherFunds: 0,
                    annualRoyalty: (month === 12 && (rank.includes('Diamond') || rank.includes('Crown'))) ? cumulativeGbv * royaltyRate : 0
                };

                // Calculate Other Funds based on rank
                if (rank === 'Bronze Director') incomes.otherFunds = monthlyGbv * 0.02;
                else if (rank === 'Silver Director') incomes.otherFunds = monthlyGbv * 0.04;
                else if (rank === 'Gold Director') incomes.otherFunds = monthlyGbv * 0.06;
                else if (rank === 'Ruby Director') incomes.otherFunds = monthlyGbv * 0.08;
                else if (rank.includes('Diamond')) incomes.otherFunds = monthlyGbv * 0.12;

                // Calculate total income for this month
                const totalMonthIncome = Object.values(incomes).reduce((sum, val) => sum + val, 0);

                // Create HTML for this month's breakdown
                const monthHTML = `
                    <div style="margin-bottom: 40px; border: 3px solid #2196f3; border-radius: 15px; padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                        <h2 style="color: #1565c0; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 24px;">
                            <span>üìÖ</span>
                            <span>Month ${month} - Detailed Income Breakdown</span>
                            <span style="margin-left: auto; background: #1976d2; color: white; padding: 8px 16px; border-radius: 8px; font-size: 18px;">Total: ‚Çπ${Math.round(totalMonthIncome).toLocaleString('en-IN')}</span>
                        </h2>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Self DP</div>
                                <div style="color: #1976d2; font-size: 20px; font-weight: bold;">${selfDp.toLocaleString('en-IN')}</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Monthly GBV</div>
                                <div style="color: #1976d2; font-size: 20px; font-weight: bold;">${monthlyGbv.toLocaleString('en-IN')}</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Cumulative GBV</div>
                                <div style="color: #1976d2; font-size: 20px; font-weight: bold;">${cumulativeGbv.toLocaleString('en-IN')}</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Current Rank</div>
                                <div style="color: #1976d2; font-size: 20px; font-weight: bold;">${rank}</div>
                            </div>
                        </div>

                        <div class="income-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">
                            
                            <div class="income-card income-card-1">
                                <h3>üí∞ Income 1: Retail Profit</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.retailProfit).toLocaleString('en-IN')}</div>
                                <div class="description">${retailMarginRate}% of Self DP</div>
                                <div class="details">
                                    Self DP: ${selfDp.toLocaleString('en-IN')}<br>
                                    Retail Profit (${retailMarginRate}%): ‚Çπ${Math.round(incomes.retailProfit).toLocaleString('en-IN')}
                                </div>
                            </div>

                            <div class="income-card income-card-2">
                                <h3>üìä Income 2: Performance Bonus</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.performanceBonus).toLocaleString('en-IN')}</div>
                                <div class="description">Up to 23% on Monthly GBV</div>
                                <div class="details">
                                    Monthly GBV: ${monthlyGbv.toLocaleString('en-IN')}<br>
                                    Your Rate: ${(getPerformanceRate(cumulativeGbv) * 100).toFixed(0)}%<br>
                                    Bonus: ‚Çπ${Math.round(incomes.performanceBonus).toLocaleString('en-IN')}
                                </div>
                            </div>

                            <div class="income-card income-card-3">
                                <h3>üîÑ Income 3: Repurchase Bonus</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.repurchaseBonus).toLocaleString('en-IN')}</div>
                                <div class="description">8,450 + Retail Margin (${retailMarginRate}%)</div>
                                <div class="details">
                                    ${incomes.repurchaseBonus > 0 ? 
                                        `‚úì <strong>QUALIFIED!</strong><br>Base Bonus: 8,450<br>Retail Margin (${retailMarginRate}%): ${Math.round(incomes.repurchaseRetailMargin || 0).toLocaleString('en-IN')}<br><strong>Total Income: ‚Çπ${Math.round(incomes.repurchaseBonus).toLocaleString('en-IN')}</strong><br>Self DP: ${selfDp.toLocaleString('en-IN')} (‚â• 48,000)` :
                                        `Self DP: ${selfDp.toLocaleString('en-IN')}<br>${selfDp >= 48000 ? '‚úì' : '‚úó'} Need 48,000+ for bonus`
                                    }<br>
                                    <small>Instant bonus on large purchases<br>Received as FREE PRODUCT</small>
                                </div>
                            </div>

                            <div class="income-card income-card-4">
                                <h3>üéÅ Income 4: Loyalty Bonus</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.loyaltyBonus).toLocaleString('en-IN')}</div>
                                <div class="description">Free Product (6 or 12 month milestones)</div>
                                <div class="details">
                                    ${monthBonuses.loyaltyQualifying ? 
                                        `‚úì <strong>AWARDED!</strong> ‚Çπ${incomes.loyaltyBonus.toLocaleString('en-IN')} free product + 30% retail margin<br>Based on ${monthBonuses.loyaltyType === 'loyalty_12' ? '12-month (DOUBLE amount)' : '6-month'} milestone<br><small style="color: #f57c00;">Counter resets - start new streak from next month</small>` :
                                        monthBonuses.loyaltySuperseded ?
                                        `‚ö†Ô∏è <strong>QUALIFIED BUT NOT AWARDED</strong><br>You qualified for ‚Çπ${monthBonuses.loyaltySupersededAmount.toLocaleString('en-IN')} Loyalty Bonus<br><small style="color: #d32f2f;">However, Super Loyalty Bonus was awarded instead<br>(Higher tier bonus takes precedence)</small>` :
                                        `Progress: ${monthBonuses.loyaltyProgress}/6 qualifying months<br>${isValidLoyaltyAmount(selfDp) ? '‚úì This month qualifies (‚Çπ1,500 multiple)' : '‚úó This month does not qualify'}<br><small>6-month: Base + 30% margin | 12-month: Double Base + 30% margin</small>`
                                    }<br>
                                    <small>Received as FREE PRODUCT (not cash) + 30% retail margin</small>
                                </div>
                            </div>

                            <div class="income-card income-card-5">
                                <h3>‚≠ê Income 5: Super Loyalty Bonus</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.superLoyaltyBonus).toLocaleString('en-IN')}</div>
                                <div class="description">‚Çπ48,000+ consistent purchases</div>
                                <div class="details">
                                    ${monthBonuses.superLoyalty5Month > 0 ? `‚úì <strong>5-MONTH AWARD:</strong><br>Base: 48,000 + Retail Profit (${retailMarginRate}%): ${Math.round(monthBonuses.superLoyalty5RetailProfit).toLocaleString('en-IN')}<br><strong>Total Income: ‚Çπ${Math.round(monthBonuses.superLoyalty5Month).toLocaleString('en-IN')}</strong><br><small>Counter resets - start new streak</small><br>` : ''}
                                    ${monthBonuses.superLoyalty12Month > 0 ? `‚úì <strong>12-MONTH AWARD:</strong><br>Base: 96,000 + Retail Profit (${retailMarginRate}%): ${Math.round(monthBonuses.superLoyalty12RetailProfit).toLocaleString('en-IN')}<br><strong>Total Income: ‚Çπ${Math.round(monthBonuses.superLoyalty12Month).toLocaleString('en-IN')}</strong><br><small>Complete year achievement!</small><br>` : ''}
                                    ${totalSuperLoyalty === 0 ? `Progress: ${monthBonuses.superLoyaltyProgress} month(s) of ‚Çπ48,000+<br>${selfDp >= 48000 ? '‚úì' : '‚úó'} This month: ‚Çπ${selfDp.toLocaleString('en-IN')}<br>` : ''}
                                    <small>Free products + Retail profit opportunity<br>
                                    5-months: 48,000 base | 12-months: 96,000 base</small>
                                </div>
                            </div>

                            <div class="income-card income-card-6">
                                <h3>üë• Income 6: Team Building Bonus</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.teamBuildingBonus).toLocaleString('en-IN')}</div>
                                <div class="description">7% from company pool</div>
                                <div class="details">
                                    Based on 2X, 3X, 4X achievements<br>
                                    Current Rank: ${rank}
                                </div>
                            </div>

                            <div class="income-card income-card-7">
                                <h3>üíº Income 7: Director Fund</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.directorFund).toLocaleString('en-IN')}</div>
                                <div class="description">4% of Monthly GBV</div>
                                <div class="details">
                                    ${(rank.includes('Director') || rank.includes('Diamond') || rank.includes('Crown')) ? '‚úì Qualified (Director or above)' : '‚úó Not Qualified (Need Director rank)'}<br>
                                    Monthly GBV: ${monthlyGbv.toLocaleString('en-IN')}<br>
                                    Director Fund (${(directorRate * 100).toFixed(0)}%): ‚Çπ${Math.round(incomes.directorFund).toLocaleString('en-IN')}
                                </div>
                            </div>

                            <div class="income-card income-card-8">
                                <h3>üöÄ Income 8: Business Building</h3>
                                <div class="amount" style="font-size: 16px; color: #667eea;">See CTO Section ‚Üì</div>
                                <div class="description">2X, 3X, 4X Bonuses (Cumulative up to 21%)</div>
                                <div class="details">
                                    üìä <strong>Calculated on 12-month cumulative data</strong><br><br>
                                    <strong>Cumulative Structure (PDF Pages 10, 12, 14):</strong><br>
                                    ‚Ä¢ 2X: 8% (2+ legs √ó 10K GBV) - Bronze+<br>
                                    ‚Ä¢ 3X: 16% (3+ legs √ó 10K GBV) - Silver+ (8%+8%)<br>
                                    ‚Ä¢ 4X: 21% (4+ legs √ó 10K GBV) - Gold+ (8%+8%+5%)<br><br>
                                    <strong style="color: #667eea;">üí∞ View detailed calculation in "Company Turnover Based Bonuses" section below</strong>
                                </div>
                            </div>

                            <div class="income-card income-card-9">
                                <h3>üëë Income 9: Leadership Bonus</h3>
                                <div class="amount" style="font-size: 16px; color: #667eea;">See CTO Section ‚Üì</div>
                                <div class="description">Up to 21% multi-level structure</div>
                                <div class="details">
                                    üìä <strong>Calculated on 12-month cumulative data</strong><br><br>
                                    <strong>Your Level Earnings:</strong> 5% of CTO<br>
                                    <strong>Current Rank:</strong> ${rank}<br>
                                    <strong>Total GBV:</strong> ${cumulativeGbv.toLocaleString('en-IN')}<br><br>
                                    <strong>Rank Progression:</strong><br>
                                    Director ‚Üí Gold (17%) ‚Üí Ruby (18%) ‚Üí Diamond+ (21%)<br><br>
                                    <strong style="color: #667eea;">üí∞ View detailed calculation in "Company Turnover Based Bonuses" section below</strong>
                                </div>
                            </div>

                            <div class="income-card income-card-10">
                                <h3>üè† Income 10: Other Funds</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.otherFunds).toLocaleString('en-IN')}</div>
                                <div class="description">Travel, Vehicle, House</div>
                                <div class="details">
                                    Bronze: 2% | Silver: 4% | Gold: 6%<br>
                                    Ruby: 8% | Diamond: 12%<br>
                                    Current: ${rank} - ${incomes.otherFunds > 0 ? (incomes.otherFunds / monthlyGbv * 100).toFixed(0) + '%' : '0%'}
                                </div>
                            </div>

                            <div class="income-card income-card-11">
                                <h3>üéñÔ∏è Income 11: Annual Royalty</h3>
                                <div class="amount">‚Çπ ${Math.round(incomes.annualRoyalty).toLocaleString('en-IN')}</div>
                                <div class="description">5% yearly bonus (Month 12 only)</div>
                                <div class="details">
                                    ${(month === 12 && (rank.includes('Diamond') || rank.includes('Crown'))) ? '‚úì Qualified (Diamond rank in Month 12)' : '‚úó ' + (month !== 12 ? 'Only available in Month 12' : 'Not Qualified (Need Diamond rank)')}<br>
                                    Cumulative GBV: ${cumulativeGbv.toLocaleString('en-IN')}<br>
                                    Annual Royalty (${(royaltyRate * 100).toFixed(0)}%): ‚Çπ${Math.round(incomes.annualRoyalty).toLocaleString('en-IN')}
                                </div>
                            </div>

                        </div>
                    </div>
                `;

                fullHTML += monthHTML;
            });

            // ============================================
            // ADD CTO BONUSES SECTION AT THE END
            // ============================================
            const ctoBonuses = calculateAllCTOBonuses(cumulative);
            const totalCTOBonus = (ctoBonuses.tbb?.bonus || 0) + (ctoBonuses.bbb?.bonus || 0) + (ctoBonuses.lb?.bonus || 0);
            
            const ctoBonusHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; margin-top: 30px; color: white; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
                    <h2 style="margin: 0 0 20px 0; font-size: 24px; border-bottom: 3px solid rgba(255,255,255,0.3); padding-bottom: 15px; text-align: center;">
                        üí∞ Company Turnover (CTO) Based Bonuses
                    </h2>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="text-align: center; font-size: 14px; opacity: 0.9;">
                            <strong>üìå Note:</strong> These bonuses are calculated on cumulative 12-month performance<br>
                            CTO: ‚Çπ${(parseFloat(document.getElementById('companyTurnOver').value) || 10000000).toLocaleString('en-IN')} | 
                            Total Qualifiers: ${parseFloat(document.getElementById('bonusPoint').value) || 1000}
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
                        <!-- Team Building Bonus -->
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px); border: 2px solid rgba(255,255,255,0.2);">
                            <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px; opacity: 0.95;">
                                ü§ù Team Building Bonus
                            </div>
                            <div style="font-size: 32px; font-weight: bold; margin: 15px 0;">
                                ‚Çπ${(ctoBonuses.tbb?.bonus || 0).toLocaleString('en-IN')}
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; font-size: 13px; line-height: 1.6;">
                                <strong>Bonus Rate:</strong> ${ctoBonuses.tbb?.percent || 0}% of CTO<br>
                                <strong>Type:</strong> ${ctoBonuses.tbb?.type || 'Not Qualified'}<br>
                                <strong>Qualifying Legs:</strong> ${ctoBonuses.tbb?.qualifyingLegs || 0} legs (‚â•2500 GBV each)<br>
                                <strong>Your Total GBV:</strong> ‚Çπ${(ctoBonuses.tbb?.yourGBV || 0).toLocaleString('en-IN')}
                            </div>
                            <div style="margin-top: 10px; font-size: 11px; opacity: 0.8; text-align: center;">
                                <em>Exclusive for Directors & Below</em><br>
                                <em>Max 25,000 GBV per leg at distribution</em>
                            </div>
                        </div>
                        
                        <!-- Business Building Bonus -->
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px); border: 2px solid rgba(255,255,255,0.2);">
                            <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px; opacity: 0.95;">
                                üöÄ Business Building Bonus
                            </div>
                            <div style="font-size: 32px; font-weight: bold; margin: 15px 0;">
                                ‚Çπ${(ctoBonuses.bbb?.bonus || 0).toLocaleString('en-IN')}
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; font-size: 13px; line-height: 1.6;">
                                <strong>Bonus Rate:</strong> ${ctoBonuses.bbb?.percent || 0}% of CTO<br>
                                <strong>Type:</strong> ${ctoBonuses.bbb?.type || 'Not Qualified'}<br>
                                <strong>Qualifying Legs:</strong> ${ctoBonuses.bbb?.qualifyingLegs || 0} legs (‚â•10,000 GBV each)<br>
                                <strong>Your Total GBV:</strong> ‚Çπ${(ctoBonuses.bbb?.yourGBV || 0).toLocaleString('en-IN')}
                            </div>
                            <div style="margin-top: 10px; font-size: 11px; opacity: 0.8; text-align: center;">
                                <em>Exclusive for Bronze Directors & Above</em><br>
                                <em>Cumulative: 2X (8%), 3X (16%), 4X (21%)</em>
                            </div>
                        </div>
                        
                        <!-- Leadership Bonus -->
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px); border: 2px solid rgba(255,255,255,0.2);">
                            <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px; opacity: 0.95;">
                                üëë Leadership Bonus
                            </div>
                            <div style="font-size: 32px; font-weight: bold; margin: 15px 0;">
                                ‚Çπ${(ctoBonuses.lb?.bonus || 0).toLocaleString('en-IN')}
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; font-size: 13px; line-height: 1.6;">
                                <strong>Your Level:</strong> ${ctoBonuses.lb?.yourPercent || 0}% of CTO<br>
                                <strong>Current Rank:</strong> ${ctoBonuses.rank || 'Not Qualified'}<br>
                                <strong>Total Available:</strong> ${ctoBonuses.lb?.totalPercent || 0}% across all levels<br>
                                <strong>Your Total GBV:</strong> ‚Çπ${cumulative.total.toLocaleString('en-IN')}
                            </div>
                            <div style="margin-top: 10px; font-size: 11px; opacity: 0.8; text-align: center;">
                                <em>Rank-based multi-level structure</em><br>
                                <em>Director+ earns 5% on their level</em>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Total CTO Bonuses -->
                    <div style="background: rgba(255,255,255,0.25); padding: 20px; border-radius: 12px; text-align: center; border: 3px solid rgba(255,255,255,0.4);">
                        <div style="font-size: 18px; margin-bottom: 10px; opacity: 0.95;">
                            <strong>üìä Total Company Turnover Based Bonuses</strong>
                        </div>
                        <div style="font-size: 40px; font-weight: bold; margin: 10px 0;">
                            ‚Çπ${totalCTOBonus.toLocaleString('en-IN')}
                        </div>
                        <div style="font-size: 14px; opacity: 0.9;">
                            Team Building (‚Çπ${(ctoBonuses.tbb?.bonus || 0).toLocaleString('en-IN')}) + 
                            Business Building (‚Çπ${(ctoBonuses.bbb?.bonus || 0).toLocaleString('en-IN')}) + 
                            Leadership (‚Çπ${(ctoBonuses.lb?.bonus || 0).toLocaleString('en-IN')})
                        </div>
                    </div>
                    
                    <!-- Calculation Details -->
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 12px; line-height: 1.8;">
                        <strong style="display: block; margin-bottom: 10px; font-size: 14px;">üìê Calculation Formula:</strong>
                        <div style="opacity: 0.9;">
                            <strong>Bonus = (Your GBV / Sum of all qualifiers GBV) √ó Bonus % √ó CTO</strong><br><br>
                            <strong>Team Building Qualifiers:</strong> 2X=${document.getElementById('tbb2x').value}, 3X=${document.getElementById('tbb3x').value}, 4X=${document.getElementById('tbb4x').value}<br>
                            <strong>Business Building Qualifiers:</strong> 2X=${document.getElementById('bbb2x').value}, 3X=${document.getElementById('bbb3x').value}, 4X=${document.getElementById('bbb4x').value}<br>
                            <strong>Your Leg BVs:</strong> [${cumulative.leg1.toFixed(0)}, ${cumulative.leg2.toFixed(0)}, ${cumulative.leg3.toFixed(0)}, ${cumulative.leg4.toFixed(0)}, ${cumulative.leg5.toFixed(0)}]
                        </div>
                    </div>
                </div>
            `;
            
            fullHTML += ctoBonusHTML;

            document.getElementById('incomeBreakdown').innerHTML = fullHTML;
        }

        // Quick Fill Functions
        function fillBasicPlan() {
            const plans = Array(12).fill([1500, 0, 0, 0, 0, 0]);
            fillPlan(plans);
        }

        function fillBasicTeamPlan() {
            const plans = Array(12).fill([1500, 500, 500, 500, 500, 0]);
            fillPlan(plans);
        }

        function fillLearningPlan() {
            const plans = Array(12).fill([15000, 0, 0, 0, 0, 0]);
            fillPlan(plans);
        }

        function fillLearningTeamPlan() {
            const plans = Array(12).fill([15000, 5000, 5000, 5000, 5000, 0]);
            fillPlan(plans);
        }

        function fillDigitalClinicPlan() {
            const plans = Array(12).fill([48000, 0, 0, 0, 0, 0]);
            fillPlan(plans);
        }

        function fillDigitalClinicTeamPlan() {
            const plans = Array(12).fill([48000, 16000, 16000, 16000, 16000, 0]);
            fillPlan(plans);
        }

        function fillCTOBonusTestPlan() {
            // Special test plan designed to trigger ALL CTO bonuses clearly
            // This will show:
            // - Team Building Bonus (4X): 4 legs with 15000+ GBV each (after DP to BV conversion)
            // - Business Building Bonus (4X): 4 legs with 12000+ GBV each
            // - Leadership Bonus: Will reach Gold Director level (85,000+ GBV)
            
            const plans = Array(12).fill([
                15000,  // Self DP ‚Üí ~5250 BV (35%)
                12000,  // Leg 1: 12000 GBV (qualifies for both TBB & BBB)
                12000,  // Leg 2: 12000 GBV (qualifies for both TBB & BBB)
                12000,  // Leg 3: 12000 GBV (qualifies for both TBB & BBB)
                12000,  // Leg 4: 12000 GBV (qualifies for both TBB & BBB)
                0       // Leg 5: Not used
            ]);
            // Total per month: ~53,250 GBV
            // 12 months cumulative: ~639,000 GBV ‚Üí Gold Director+ level
            
            fillPlan(plans);
            
            // Show alert to inform user
            alert('üí∞ CTO Bonus Test Plan loaded!\n\n' +
                  '‚úÖ Team Building Bonus (4X - 7%): 4 legs qualify\n' +
                  '‚úÖ Business Building Bonus (4X - 21% cumulative): 4 legs qualify\n' +
                  '‚úÖ Leadership Bonus (5%): Gold Director+ rank\n\n' +
                  'Scroll down to see the purple "Company Turnover Based Bonuses" section in the summary!');
        }

        function fillPlan(plans) {
            plans.forEach((plan, index) => {
                const month = index + 1;
                document.querySelector(`.self-dp[data-month="${month}"]`).value = plan[0];
                document.querySelector(`.leg1[data-month="${month}"]`).value = plan[1];
                document.querySelector(`.leg2[data-month="${month}"]`).value = plan[2];
                document.querySelector(`.leg3[data-month="${month}"]`).value = plan[3];
                document.querySelector(`.leg4[data-month="${month}"]`).value = plan[4];
                document.querySelector(`.leg5[data-month="${month}"]`).value = plan[5];
            });
            calculateAll();
        }

        function clearAll() {
            for (let month = 1; month <= 12; month++) {
                document.querySelector(`.self-dp[data-month="${month}"]`).value = '';
                document.querySelector(`.leg1[data-month="${month}"]`).value = '';
                document.querySelector(`.leg2[data-month="${month}"]`).value = '';
                document.querySelector(`.leg3[data-month="${month}"]`).value = '';
                document.querySelector(`.leg4[data-month="${month}"]`).value = '';
                document.querySelector(`.leg5[data-month="${month}"]`).value = '';
            }
            calculateAll();
        }

        // Export to Excel
        function exportToExcel() {
            // Get current DP to BV rate from Calculator Settings for accurate column header
            const dpToBvRate = parseFloat(document.getElementById('dpToBvRate').value) || 30;
            
            let csv = 'Dr. Nature Wellness - Accumulative Business Plan Report (Enhanced)\n\n';
            csv += `Month,Self DP,DP BV (${dpToBvRate}%),G1 BV,G2 BV,G3 BV,G4 BV,G5 BV,Monthly GBV,Cumulative GBV,Rank,Monthly Income\n`;
            
            for (let month = 1; month <= 12; month++) {
                const selfDp = document.querySelector(`.self-dp[data-month="${month}"]`).value;
                const dpBV = document.getElementById(`dpBV${month}`).textContent;
                const leg1 = document.querySelector(`.leg1[data-month="${month}"]`).value;
                const leg2 = document.querySelector(`.leg2[data-month="${month}"]`).value;
                const leg3 = document.querySelector(`.leg3[data-month="${month}"]`).value;
                const leg4 = document.querySelector(`.leg4[data-month="${month}"]`).value;
                const leg5 = document.querySelector(`.leg5[data-month="${month}"]`).value;
                const monthlyGbv = document.getElementById(`monthlyGbv${month}`).textContent;
                const cumulativeGbv = document.getElementById(`cumulativeGbv${month}`).textContent;
                const rank = document.getElementById(`rank${month}`).textContent;
                const income = document.getElementById(`income${month}`).textContent;
                
                csv += `${month},${selfDp},${dpBV},${leg1},${leg2},${leg3},${leg4},${leg5},${monthlyGbv},${cumulativeGbv},${rank},${income}\n`;
            }
            
            csv += '\n\nIndividual Group BV Summary:\n';
            csv += `G1 Total BV,${document.getElementById('g1TotalBV').textContent}\n`;
            csv += `G2 Total BV,${document.getElementById('g2TotalBV').textContent}\n`;
            csv += `G3 Total BV,${document.getElementById('g3TotalBV').textContent}\n`;
            csv += `G4 Total BV,${document.getElementById('g4TotalBV').textContent}\n`;
            csv += `G5 Total BV (Optional),${document.getElementById('g5TotalBV').textContent}\n`;
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `dr_nature_enhanced_plan_${Date.now()}.csv`);
            link.click();
        }

        // ============================================
        // COMPANY TURNOVER BASED BONUS CALCULATIONS  
        // ============================================
        
        function calculateAllCTOBonuses(cumulative) {
            const legBVs = [cumulative.leg1, cumulative.leg2, cumulative.leg3, cumulative.leg4, cumulative.leg5];
            const yourTotalGBV = cumulative.total;
            const rank = determineRank(yourTotalGBV);
            
            // Calculate all three bonuses
            const tbb = calculateTeamBuildingBonus(legBVs);
            const bbb = calculateBusinessBuildingBonus(legBVs);
            const lb = calculateLeadershipBonus(rank, yourTotalGBV);
            
            return { tbb, bbb, lb, rank };
        }
        
        // Team Building Bonus - 7% (Exclusive for Directors & Below)
        // As per PDF Page 6:
        // 2X Bonus = 3% (min 2500 GBV from 2 different legs)
        // 3X Bonus = 2% additional (min 2500 GBV from 3 different legs) - Cumulative: 5%
        // 4X Bonus = 2% additional (min 2500 GBV from 4 different legs) - Cumulative: 7%
        // Max 25000 GBV per leg at fund distribution
        function calculateTeamBuildingBonus(legBVs) {
            const cto = parseFloat(document.getElementById('companyTurnOver').value) || 10000000;
            const tbb2x = parseFloat(document.getElementById('tbb2x').value) || 300;
            const tbb3x = parseFloat(document.getElementById('tbb3x').value) || 300;
            const tbb4x = parseFloat(document.getElementById('tbb4x').value) || 300;
            
            // Cap each leg at 25000 GBV at fund distribution
            const cappedLegs = legBVs.map(bv => Math.min(bv, 25000));
            const qualifyingLegs = cappedLegs.filter(bv => bv >= 2500).length;
            
            let percent = 0, type = '', qualifiers = 0;
            // 4X = 7% cumulative (3% + 2% + 2%)
            if (qualifyingLegs >= 4) { percent = 7; type = '4X'; qualifiers = tbb4x; }
            // 3X = 5% cumulative (3% + 2%)
            else if (qualifyingLegs >= 3) { percent = 5; type = '3X'; qualifiers = tbb3x; }
            // 2X = 3%
            else if (qualifyingLegs >= 2) { percent = 3; type = '2X'; qualifiers = tbb2x; }
            
            if (percent > 0) {
                const yourGBV = cappedLegs.reduce((a, b) => a + b, 0);
                const totalGBV = yourGBV * qualifiers;
                const bonus = (yourGBV / totalGBV) * (percent / 100) * cto;
                return { bonus: Math.round(bonus), percent, type, qualifyingLegs, yourGBV };
            }
            return { bonus: 0, percent: 0, type: 'Not Qualified', qualifyingLegs: 0, yourGBV: 0 };
        }
        
        // Business Building Bonus - As per PDF Pages 10, 12, 14:
        // Bonuses are CUMULATIVE - higher ranks get lower tier bonuses too
        // 2X Bonus = 8% (Bronze Directors & Above) - Min 10,000 GBV from 2 legs, Max Limit: 20,000/-
        // 3X Bonus = 8% additional (Silver Directors & Above) - Min 10,000 GBV from 3 legs, Max Limit: 1,00,000/-
        // 4X Bonus = 5% additional (Gold Directors & Above) - Min 10,000 GBV from 4 legs, Max Limit: 1,00,000/-
        // Total possible: 8% + 8% + 5% = 21%
        function calculateBusinessBuildingBonus(legBVs) {
            const cto = parseFloat(document.getElementById('companyTurnOver').value) || 10000000;
            const bbb2x = parseFloat(document.getElementById('bbb2x').value) || 300;
            const bbb3x = parseFloat(document.getElementById('bbb3x').value) || 300;
            const bbb4x = parseFloat(document.getElementById('bbb4x').value) || 300;
            
            const qualifyingLegs = legBVs.filter(bv => bv >= 10000).length;
            
            let percent = 0, type = '', qualifiers = 0, maxLimit = 0;
            // 4X = 21% cumulative (8% + 8% + 5%) - Gold Directors & Above
            if (qualifyingLegs >= 4) { percent = 21; type = '4X (8%+8%+5%)'; qualifiers = bbb4x; maxLimit = 100000; }
            // 3X = 16% cumulative (8% + 8%) - Silver Directors & Above
            else if (qualifyingLegs >= 3) { percent = 16; type = '3X (8%+8%)'; qualifiers = bbb3x; maxLimit = 100000; }
            // 2X = 8% - Bronze Directors & Above
            else if (qualifyingLegs >= 2) { percent = 8; type = '2X (8%)'; qualifiers = bbb2x; maxLimit = 20000; }
            
            if (percent > 0) {
                const yourGBV = legBVs.reduce((a, b) => a + b, 0);
                const totalGBV = yourGBV * qualifiers;
                let bonus = (yourGBV / totalGBV) * (percent / 100) * cto;
                // Apply maximum limit based on tier
                bonus = Math.min(bonus, maxLimit);
                return { bonus: Math.round(bonus), percent, type, qualifyingLegs, yourGBV, maxLimit };
            }
            return { bonus: 0, percent: 0, type: 'Not Qualified', qualifyingLegs: 0, yourGBV: 0, maxLimit: 0 };
        }
        
        // Leadership Bonus Structure - As per PDF Pages 9, 11, 13, 15, 16, 17, 18, 19, 20, 21, 22
        // Bronze Director: YOU 5%, L1: 5%, L2: 3% = Total 13%
        // Silver Director: YOU 5%, L1: 5%, L2: 3%, L3: 2% = Total 15%
        // Gold Director: YOU 5%, L1: 5%, L2: 3%, L3: 2%, L4: 2% = Total 17%
        // Ruby Director: YOU 5%, L1: 5%, L2: 3%, L3: 2%, L4: 2%, L5: 1% = Total 18%
        // Diamond Director: YOU 5%, L1: 5%, L2: 3%, L3: 2%, L4: 2%, L5: 1%, L6: 1% = Total 19%
        // Double Diamond: YOU 5%, L1: 5%, L2: 3%, L3: 2%, L4: 2%, L5: 1%, L6: 1%, L7: 0.5% = Total 19.5%
        // Blue Diamond: YOU 5%, L1: 5%, L2: 3%, L3: 2%, L4: 2%, L5: 1%, L6: 1%, L7: 0.5%, L8: 0.5% = Total 20%
        // Black Diamond: YOU 5%, L1: 5%, L2: 3%, L3: 2%, L4: 2%, L5: 1%, L6: 1%, L7: 0.5%, L8: 0.5%, L9: 0.5% = Total 20.5%
        // Crown Diamond: YOU 5%, L1: 5%, L2: 3%, L3: 2%, L4: 2%, L5: 1%, L6: 1%, L7: 0.5%, L8: 0.5%, L9: 0.5%, L10: 0.5% = Total 21%
        // Crown Ambassador: Same as Crown Diamond = Total 21%
        // Crown President: Same as Crown Diamond = Total 21%
        function calculateLeadershipBonus(rank, yourGBV) {
            const structure = {
                'Director': { you: 5, levels: [], total: 5 },
                'Bronze Director': { you: 5, levels: [5, 3], total: 13 },
                'Silver Director': { you: 5, levels: [5, 3, 2], total: 15 },
                'Gold Director': { you: 5, levels: [5, 3, 2, 2], total: 17 },
                'Ruby Director': { you: 5, levels: [5, 3, 2, 2, 1], total: 18 },
                'Diamond Director': { you: 5, levels: [5, 3, 2, 2, 1, 1], total: 19 },
                'Double Diamond': { you: 5, levels: [5, 3, 2, 2, 1, 1, 0.5], total: 19.5 },
                'Blue Diamond': { you: 5, levels: [5, 3, 2, 2, 1, 1, 0.5, 0.5], total: 20 },
                'Black Diamond': { you: 5, levels: [5, 3, 2, 2, 1, 1, 0.5, 0.5, 0.5], total: 20.5 },
                'Crown Diamond': { you: 5, levels: [5, 3, 2, 2, 1, 1, 0.5, 0.5, 0.5, 0.5], total: 21 },
                'Crown Ambassador': { you: 5, levels: [5, 3, 2, 2, 1, 1, 0.5, 0.5, 0.5, 0.5], total: 21 },
                'Crown President': { you: 5, levels: [5, 3, 2, 2, 1, 1, 0.5, 0.5, 0.5, 0.5], total: 21 }
            };
            
            if (!structure[rank]) {
                return { bonus: 0, yourPercent: 0, totalPercent: 0, levels: [] };
            }
            
            const cto = parseFloat(document.getElementById('companyTurnOver').value) || 10000000;
            const qualifiers = parseFloat(document.getElementById('bonusPoint').value) || 1000;
            const totalGBV = yourGBV * qualifiers;
            const bonus = (yourGBV / totalGBV) * (structure[rank].you / 100) * cto;
            
            return {
                bonus: Math.round(bonus),
                yourPercent: structure[rank].you,
                totalPercent: structure[rank].total,
                levels: structure[rank].levels
            };
        }

        // Initialize
        window.onload = function() {
            initializeTable();
            calculateAll();
            calculatePerformanceBonus();
            initializeCardModals();
        };

        // Full Screen Card Modal Functionality
        function initializeCardModals() {
            const cards = document.querySelectorAll('.dist-category-box');
            
            cards.forEach(card => {
                card.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    openCardModal(this);
                });
            });
        }

        function openCardModal(cardElement) {
            // Create modal overlay
            const modal = document.createElement('div');
            modal.className = 'card-modal-overlay active';
            
            // Create modal content container
            const modalContent = document.createElement('div');
            modalContent.className = 'card-modal-content';
            
            // Clone the card content
            const clonedCard = cardElement.cloneNode(true);
            clonedCard.style.width = '100%';
            clonedCard.style.height = 'auto';
            clonedCard.style.maxHeight = 'none';
            clonedCard.style.position = 'relative';
            clonedCard.style.display = 'block';
            
            // Remove hover text from cloned card
            clonedCard.style.setProperty('cursor', 'default');
            
            // Create close button
            const closeBtn = document.createElement('button');
            closeBtn.className = 'card-modal-close';
            closeBtn.innerHTML = '√ó';
            closeBtn.setAttribute('aria-label', 'Close');
            
            // Assemble modal
            modalContent.appendChild(closeBtn);
            modalContent.appendChild(clonedCard);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Force display
            setTimeout(() => {
                modal.style.display = 'flex';
            }, 10);
            
            // Close on button click
            closeBtn.addEventListener('click', function() {
                closeCardModal(modal);
            });
            
            // Close on backdrop click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeCardModal(modal);
                }
            });
            
            // Close on Escape key
            const escapeHandler = function(e) {
                if (e.key === 'Escape') {
                    closeCardModal(modal);
                    document.removeEventListener('keydown', escapeHandler);
                }
            };
            document.addEventListener('keydown', escapeHandler);
        }

        function closeCardModal(modal) {
            modal.classList.remove('active');
            setTimeout(() => {
                modal.remove();
            }, 300);
        }
    </script>
</body>
</html>
